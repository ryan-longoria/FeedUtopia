import{u as D,b as H,g as X,a as Z,c as ee}from"./chunks/include-BthP2BiG.js";import"https://esm.sh/aws-amplify@6";import"https://esm.sh/aws-amplify@6/auth";import"https://esm.sh/aws-amplify@6/utils";const W=(window.WU_MEDIA_BASE||"").replace(/\/+$/,"");function p(e,i="/assets/avatar-fallback.svg"){if(!e)return i;const t=String(e).trim();return/^https?:\/\//i.test(t)?t:W?`${W}/${t.replace(/^\/+/,"")}`:t.replace(/^\/+/,"")}const l=e=>document.querySelector(e),u=(e,i="")=>{const t=document.getElementById(e);t&&(t.value=i??"")},te=(e,i)=>{const t=l(e);if(!t)return;if(!i){t.src="/assets/avatar-fallback.svg";return}const n=p(String(i)),c=/^public\/wrestlers\/profiles\//.test(String(i))||/^profiles\//.test(String(i));t.src=c?`${n}?v=${Date.now()}`:n};let y=[],g=[];(window.WU_MEDIA_BASE||"").replace(/\/+$/,"");function w(){const e=document.getElementById("photoGrid");e&&(e.innerHTML=(y||[]).map((i,t)=>`
      <div class="media-card">
        <img src="${typeof i=="string"&&i.startsWith("raw/")?"/assets/image-processing.svg":p(i)}" alt="">
        <button class="btn secondary media-remove" type="button" data-i="${t}">Remove</button>
      </div>
    `).join(""),e.querySelectorAll(".media-remove").forEach(i=>{i.onclick=()=>{y.splice(Number(i.dataset.i),1),w()}}))}function h(){const e=document.getElementById("highlightList");e&&(e.innerHTML=(g||[]).map((i,t)=>`
    <li>
      <span style="flex:1; word-break:break-all">${i}</span>
      <button class="btn secondary" type="button" data-i="${t}">Remove</button>
    </li>
  `).join(""),e.querySelectorAll("button").forEach(i=>{i.onclick=()=>{g.splice(Number(i.dataset.i),1),h()}}))}function ae(e){return e?p(String(e)):"/assets/avatar-fallback.svg"}function b(e,i="success"){const t=l("#toast");if(!t)return console.log(e);t.textContent=e,t.classList.toggle("error",i==="error"),t.style.display="block",setTimeout(()=>t.style.display="none",2400)}async function ie(){const e=await X();return Z(e)?e:(b("Wrestler role required","error"),location.replace("index.html"),null)}function ne(e){const i=new FormData(e),t={};for(const[n,c]of i.entries())t[n]=c;return t.heightIn=Number(t.heightIn||NaN),t.weightLb=Number(t.weightLb||NaN),t.bio=(t.bio||"").trim()||null,t.gimmicks=(t.gimmicks||"").split(",").map(n=>n.trim()).filter(Boolean),t.socials={twitter:(t.social_twitter||"").trim()||null,instagram:(t.social_instagram||"").trim()||null,tiktok:(t.social_tiktok||"").trim()||null,youtube:(t.social_youtube||"").trim()||null,website:(t.social_website||"").trim()||null},Object.keys(t.socials).forEach(n=>{t.socials[n]||delete t.socials[n]}),t.experienceYears=(t.experienceYears||"").toString().trim()===""?null:Number(t.experienceYears),t.achievements=(t.achievements||"").trim()||null,t}function O(e,i,t){if(e&&(e.disabled=!!i,t)){const n=e.dataset.prevText||e.textContent;i?(e.dataset.prevText=n,e.textContent=t):e.textContent=e.dataset.prevText||e.textContent}}async function oe(){var t;const e=document.getElementById("avatar"),i=(t=e==null?void 0:e.files)==null?void 0:t[0];return i?await ee(i):null}async function se(){try{const e=await H("/profiles/wrestlers/me");if(!e||!e.userId)return;y=Array.isArray(e.mediaKeys)?[...e.mediaKeys]:[],g=Array.isArray(e.highlights)?[...e.highlights]:[],w(),h(),window.profile=e;const i={firstName:"firstName",middleName:"middleName",lastName:"lastName",stageName:"stageName",dob:"dob",city:"city",region:"region",country:"country",heightIn:"heightIn",weightLb:"weightLb",bio:"bio",experienceYears:"experienceYears",achievements:"achievements"};if(e.socials){const n=e.socials;n.twitter&&u("social_twitter",n.twitter),n.instagram&&u("social_instagram",n.instagram),n.tiktok&&u("social_tiktok",n.tiktok),n.youtube&&u("social_youtube",n.youtube),n.website&&u("social_website",n.website)}for(const[n,c]of Object.entries(i))e[n]!==void 0&&e[n]!==null&&u(c,e[n]);Array.isArray(e.gimmicks)&&e.gimmicks.length&&u("gimmicks",e.gimmicks.join(", ")),te("#avatarPreview",e.photoKey||e.avatar_key||e.avatarKey||e.photo_key||null);const t=document.getElementById("viewBtn");t&&(t.disabled=!e.handle,e.handle&&(t.dataset.handle=e.handle))}catch(e){console.debug("loadMe:",(e==null?void 0:e.message)||e)}}async function Y(){var k,E,B;if(!await ie())return;const i=document.getElementById("profileForm"),t=document.getElementById("saveBtn"),n=document.getElementById("viewBtn"),c=document.getElementById("avatar"),d=document.getElementById("avatarPreview");c==null||c.addEventListener("change",()=>{var a;const o=(a=c.files)==null?void 0:a[0];o&&d&&(d.src=URL.createObjectURL(o))}),n==null||n.addEventListener("click",()=>{var _,L,x,$,S,A,K,j,U,M,T,C;const o=(_=n==null?void 0:n.dataset)==null?void 0:_.handle;if(o){location.href=`/w/#${encodeURIComponent(o)}`;return}const a=((L=l("#stageName"))==null?void 0:L.value)||"Wrestler",r=((x=l("#firstName"))==null?void 0:x.value)||"",m=(($=l("#middleName"))==null?void 0:$.value)||"",s=((S=l("#lastName"))==null?void 0:S.value)||"",f=[r,m,s].filter(Boolean).join(" "),R=((A=l("#dob"))==null?void 0:A.value)||"",P=((K=l("#city"))==null?void 0:K.value)||"",q=((j=l("#region"))==null?void 0:j.value)||"",G=((U=l("#country"))==null?void 0:U.value)||"",N=((M=l("#bio"))==null?void 0:M.value)||"",V=(((T=l("#gimmicks"))==null?void 0:T.value)||"").split(",").map(v=>v.trim()).filter(Boolean),z=(d==null?void 0:d.src)||"/assets/avatar-fallback.svg",J=[P,q,G].filter(Boolean).join(", "),Q=`
      <div style="display:grid;grid-template-columns:120px 1fr;gap:16px">
        <img src="${z}" alt="Avatar" style="width:120px;height:120px;border-radius:999px;object-fit:cover;background:#0f1224;border:1px solid #1f2546"/>
        <div>
          <h2 style="margin:0">${a}</h2>
          <div class="muted">${J}</div>
          <div class="chips mt-2">${V.map(v=>`<span class="chip">${v}</span>`).join("")}</div>
        </div>
      </div>
      <div class="mt-3">${N?`<p>${N.replace(/\n/g,"<br/>")}</p>`:'<p class="muted">No bio yet.</p>'}</div>
      <dl class="mt-3">
        <dt class="muted">Name</dt><dd>${f}</dd>
        <dt class="muted mt-2">DOB</dt><dd>${R}</dd>
      </dl>
    `,I=document.getElementById("preview-content");I&&(I.innerHTML=Q),(C=document.getElementById("preview-modal"))==null||C.showModal()}),(k=document.getElementById("addPhotosBtn"))==null||k.addEventListener("click",async()=>{const o=document.getElementById("photoFiles"),a=Array.from((o==null?void 0:o.files)||[]);if(a.length){for(const r of a){const m=await D(r.name,r.type||"image/jpeg",r,{actor:"wrestler",type:"gallery"});y.push(m)}w(),o.value=""}}),(E=document.getElementById("addHighlightUrlBtn"))==null||E.addEventListener("click",()=>{const o=document.getElementById("highlightUrl"),a=((o==null?void 0:o.value)||"").trim();a&&(g.push(a),h(),o.value="")}),(B=document.getElementById("uploadHighlightBtn"))==null||B.addEventListener("click",async()=>{var s;const o=document.getElementById("highlightFile"),a=(s=o==null?void 0:o.files)==null?void 0:s[0];if(!a)return;const r=await D(a.name,a.type||"video/mp4",a,{actor:"wrestler",type:"highlight"}),m=typeof r=="string"&&r.startsWith("public/")?p(r):r;g.push(m),h(),o.value=""}),i==null||i.addEventListener("submit",async o=>{o.preventDefault(),O(t,!0,"Savingâ€¦");try{const a=ne(i),r=await oe().catch(()=>null);r&&(a.photoKey=r,a.avatarKey=r,a.photo_key=r,a.avatar_key=r);const m={stageName:a.stageName,firstName:a.firstName,middleName:a.middleName||null,lastName:a.lastName,dob:a.dob,city:a.city,region:a.region,country:a.country,heightIn:a.heightIn,weightLb:a.weightLb,bio:a.bio,gimmicks:a.gimmicks,socials:a.socials,experienceYears:a.experienceYears,achievements:a.achievements,photoKey:a.photoKey||null,avatarKey:a.avatarKey||null,photo_key:a.photo_key||null,avatar_key:a.avatar_key||null,mediaKeys:y,highlights:g},s=await H("/profiles/wrestlers/me",{method:"PUT",body:m});b("Profile saved!"),s!=null&&s.handle&&n&&(n.disabled=!1,n.dataset.handle=s.handle,n.onclick=()=>{location.href=`/w/#${encodeURIComponent(s.handle)}`});const f=(s==null?void 0:s.photoKey)||(s==null?void 0:s.avatarKey)||(s==null?void 0:s.avatar_key)||(s==null?void 0:s.photo_key)||a.photoKey||a.avatarKey||a.avatar_key||a.photo_key;f&&d&&(d.src=ae(f))}catch(a){console.error(a),b((a==null?void 0:a.message)||"Save failed","error")}finally{O(t,!1)}}),await se()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Y,{once:!0}):Y();const F=()=>{const e=document.getElementById("preview-modal"),i=document.getElementById("preview-close");e&&i&&i.addEventListener("click",()=>e.close())};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",F,{once:!0}):F();
