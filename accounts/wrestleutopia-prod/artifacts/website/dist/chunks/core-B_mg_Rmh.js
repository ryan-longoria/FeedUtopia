import{Amplify as D}from"https://esm.sh/aws-amplify@6";import{fetchAuthSession as A}from"https://esm.sh/aws-amplify@6/auth";import{Hub as W}from"https://esm.sh/aws-amplify@6/utils";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function o(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerPolicy&&(i.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?i.credentials="include":e.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(e){if(e.ep)return;e.ep=!0;const i=o(e);fetch(e.href,i)}})();window.WU_API="https://go2gft4394.execute-api.us-east-2.amazonaws.com";window.WU_MEDIA_BASE="https://d178p8k1vmj1zs.cloudfront.net";D.configure({Auth:{Cognito:{region:"us-east-2",userPoolId:"us-east-2_9oCzdeOZF",userPoolClientId:"6f4qoincbfm9g0lifod7q8nuhg",loginWith:{username:!1,email:!0,phone:!1},signUpVerificationMethod:"code"}}});const B="auth:changed";function $(t={}){window.dispatchEvent(new CustomEvent(B,{detail:t}))}W.listen("auth",({payload:t})=>{const{event:r}=t||{};["signedIn","signedOut","tokenRefresh"].includes(r)&&$({event:r})});(async()=>{try{await A()&&$({event:"initial"})}catch{$({event:"initial"})}})();const ne=Object.freeze(Object.defineProperty({__proto__:null,fetchAuthSession:A},Symbol.toStringTag,{value:"Module"}));function F(t,r){if(!t)throw new Error("WU_API base URL missing");return r?t.replace(/\/+$/,"")+"/"+String(r).replace(/^\/+/,""):t}async function H(){var r,o,s,e;const t=await A();return((o=(r=t==null?void 0:t.tokens)==null?void 0:r.idToken)==null?void 0:o.toString())||((e=(s=t==null?void 0:t.tokens)==null?void 0:s.accessToken)==null?void 0:e.toString())||""}async function M(t){window.SparkMD5||await new Promise((a,c)=>{const l=document.createElement("script");l.src="https://cdn.jsdelivr.net/npm/spark-md5@3.0.2/spark-md5.min.js",l.onload=a,l.onerror=c,document.head.appendChild(l)});const r=2*1024*1024,o=Math.ceil(t.size/r),s=new window.SparkMD5.ArrayBuffer;for(let a=0;a<o;a++){const c=await t.slice(a*r,Math.min((a+1)*r,t.size)).arrayBuffer();s.append(c)}const e=s.end(),i=new Uint8Array(e.length/2);for(let a=0;a<i.length;a++)i[a]=parseInt(e.substr(a*2,2),16);let n="";for(let a=0;a<i.length;a++)n+=String.fromCharCode(i[a]);return btoa(n)}async function m(t,{method:r="GET",body:o=null,headers:s={}}={}){const e=await H(),i={...s};e&&(i.Authorization=`Bearer ${e}`),o!=null&&(i["content-type"]="application/json");const n=o!=null,a=await fetch(F(window.WU_API,t),{method:r,headers:i,body:n?JSON.stringify(o):null});if(!a.ok){let l=a.statusText;try{const d=await a.text();if(d)try{l=JSON.parse(d).message||d}catch{l=d}}catch{}throw new Error(`API ${a.status}: ${l}`)}return a.status===204||a.status===205||a.status===304?null:(a.headers.get("content-type")||"").includes("application/json")?a.json():await a.text().catch(()=>"")||null}async function se(t){const r=await M(t),o=await m(`/profiles/wrestlers/me/photo-url?contentType=${encodeURIComponent(t.type||"application/octet-stream")}`,{method:"POST",headers:{"Content-MD5":r}}),s=o==null?void 0:o.uploadUrl,e=o==null?void 0:o.objectKey,i=(o==null?void 0:o.contentType)||t.type||"application/octet-stream";if(!s||!e)throw new Error("presign failed");const n=await fetch(s,{method:"PUT",headers:{"Content-Type":i,"x-amz-server-side-encryption":"AES256","Content-MD5":r},body:t});if(!n.ok)throw new Error(`S3 upload failed ${n.status}: ${await n.text().catch(()=>n.statusText)}`);return e}async function ae(t,r,o,s={}){const e=await M(o),i=new URLSearchParams({key:t||"upload.bin",contentType:r||"application/octet-stream"});s.actor&&i.set("actor",String(s.actor)),s.type&&i.set("type",String(s.type));const n=await m(`/s3/presign?${i.toString()}`,{method:"GET",headers:{"Content-MD5":e}}),a=(n==null?void 0:n.uploadUrl)||(n==null?void 0:n.url)||(n==null?void 0:n.signedUrl),c=(n==null?void 0:n.objectKey)||(n==null?void 0:n.key),l=(n==null?void 0:n.contentType)||r||"application/octet-stream";if(!a||!c)throw console.error("presign response:",n),new Error("Failed to get presigned URL (missing uploadUrl/objectKey)");const d=await fetch(a,{method:"PUT",headers:{"Content-Type":l,"x-amz-server-side-encryption":"AES256","Content-MD5":e},body:o});if(!d.ok){const u=await d.text().catch(()=>"");throw new Error(`S3 upload failed ${d.status}: ${u||d.statusText}`)}return c}function z(t){return Array.isArray(t)?t:t&&Array.isArray(t.items)?t.items:[]}window.WU_API_READY=!0;const K="modulepreload",V=function(t){return"/"+t},P={},G=function(r,o,s){let e=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),a=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));e=Promise.allSettled(o.map(c=>{if(c=V(c),c in P)return;P[c]=!0;const l=c.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":K,l||(u.as="script"),u.crossOrigin="",u.href=c,a&&u.setAttribute("nonce",a),document.head.appendChild(u),l)return new Promise((p,b)=>{u.addEventListener("load",p),u.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(n){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=n,window.dispatchEvent(a),!a.defaultPrevented)throw n}return e.then(n=>{for(const a of n||[])a.status==="rejected"&&i(a.reason);return r().catch(i)})};async function h(){var t,r;try{const o=await A(),s=(r=(t=o==null?void 0:o.tokens)==null?void 0:t.idToken)==null?void 0:r.toString();if(!s)return{signedIn:!1,groups:[],role:null,sub:null};const e=JSON.parse(atob(s.split(".")[1])),i=Array.isArray(e["cognito:groups"])?e["cognito:groups"]:e["cognito:groups"]?String(e["cognito:groups"]).split(/[,\s]+/):[],n=(e["custom:role"]||"").toLowerCase(),a=n.startsWith("promo")?"Promoter":n.startsWith("wrestl")?"Wrestler":null,c=e.sub||null;return{signedIn:!0,groups:i,role:a,sub:c}}catch{return{signedIn:!1,groups:[],role:null,sub:null}}}const w=t=>{var r;return((r=t.groups)==null?void 0:r.includes("Promoters"))||t.role==="Promoter"},v=t=>{var r;return((r=t.groups)==null?void 0:r.includes("Wrestlers"))||t.role==="Wrestler"};async function J(){const t=await h();document.body.dataset.role=t.role||"",document.body.dataset.signedin=t.signedIn?"true":"false",document.querySelectorAll('[data-auth="in"]').forEach(s=>s.style.display=t.signedIn?"":"none"),document.querySelectorAll('[data-auth="out"]').forEach(s=>s.style.display=t.signedIn?"none":"");const r=w(t),o=v(t);return document.querySelectorAll('[data-requires="promoter"]').forEach(s=>s.style.display=r?"":"none"),document.querySelectorAll('[data-requires="wrestler"]').forEach(s=>s.style.display=o?"":"none"),t}(async()=>{const t=await h();(w(t)||v(t))&&document.body.classList.add("authenticated")})();const Y=Object.freeze(Object.defineProperty({__proto__:null,applyRoleGatedUI:J,getAuthState:h,isPromoter:w,isWrestler:v},Symbol.toStringTag,{value:"Module"}));function E(t){const r=new FormData(t),o={};for(const[s,e]of r.entries())o[s]?Array.isArray(o[s])?o[s].push(e):o[s]=[o[s],e]:o[s]=e;return o}function f(t,r="success"){const o=document.querySelector("#toast");if(!o){r==="error"?console.error(t):console.log(t);return}o.textContent=t,o.classList.toggle("error",r==="error"),o.style.display="block",setTimeout(()=>o.style.display="none",2600)}window.toast=f;function C(t){const r=document.querySelector("#talent-list");if(!r)return;const o=Array.isArray(t)?t:t?[t]:[];r.innerHTML="";const s=e=>`https://picsum.photos/seed/${encodeURIComponent(e)}/200/200`;o.forEach((e,i)=>{var T;const n=e.ring||e.ringName||e.stageName||e.name||"Wrestler",a=e.name||"",c=e.years??e.yearsExperience??0,l=Array.isArray(e.styles)?e.styles:Array.isArray(e.gimmicks)?e.gimmicks:[],d=[e.city,e.region,e.country].filter(Boolean).join(", "),u=e.rate_min??e.rateMin??0,p=e.rate_max??e.rateMax??0,b=!!e.verified_school||!!e.verifiedSchool,L=e.reel||e.reelLink||"#",I=(e.photoKey&&window.WU_MEDIA_BASE?`${window.WU_MEDIA_BASE}/${e.photoKey}`:e.avatar)||s(n),S=document.createElement("div");S.className="card",S.innerHTML=`<div class="profile">
      <img src="${I}" alt="${n} profile"/>
      <div class="info">
        <div><strong>${n}</strong> <span class="muted">(${a})</span></div>
        <div class="mt-2">${d||"—"} • ${c} yrs • ${l.join(", ")}</div>
        <div class="mt-2">${b?'<span class="badge">Verified school</span>':""}</div>
        <div class="mt-2 muted">Rate: $${u}-${p}</div>
        <div class="mt-3" style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn small view-profile-btn" type="button">View Profile</button>
          ${e.handle?`<a class="btn small secondary" href="/w/#${encodeURIComponent(e.handle)}">See Full Profile</a>`:""}
        </div>
      </div>
    </div>`,(T=S.querySelector(".view-profile-btn"))==null||T.addEventListener("click",()=>{var k;const O=`
        <div style="display:grid;grid-template-columns:120px 1fr;gap:16px">
          <img src="${I}" alt="Avatar" style="width:120px;height:120px;border-radius:999px;object-fit:cover;background:#0f1224;border:1px solid #1f2546"/>
          <div>
            <h2 style="margin:0">${n}</h2>
            <div class="muted">${d||""}</div>
            <div class="chips mt-2">${l.map(j=>`<span class="chip">${j}</span>`).join("")}</div>
          </div>
        </div>
        <div class="mt-3">
          ${e.bio?`<p>${String(e.bio).replace(/\n/g,"<br/>")}</p>`:'<p class="muted">No bio yet.</p>'}
        </div>
        <dl class="mt-3">
          <dt class="muted">Name</dt><dd>${a}</dd>
          ${e.dob?`<dt class="muted mt-2">DOB</dt><dd>${e.dob}</dd>`:""}
          ${b?'<dt class="muted mt-2">School</dt><dd>Verified</dd>':""}
        </dl>
        ${L!=="#"?`<div class="mt-3"><a class="btn small secondary" href="${L}" target="_blank" rel="noopener">Watch Reel</a></div>`:""}
      `,_=document.getElementById("wm-content");_&&(_.innerHTML=O),(k=document.getElementById("wrestler-modal"))==null||k.showModal()}),r.appendChild(S)})}function Z(t){const r=document.querySelector("#tryout-list");if(!r)return;r.innerHTML="";const o=Array.isArray(t)?t:t?[t]:[];if(o.length===0){r.innerHTML='<p class="muted">No open tryouts yet.</p>';return}o.forEach(s=>{const e=s.tryoutId||s.id,i=s.orgName||s.org||"",n=s.ownerId||"",a=s.city||"",c=s.date?new Date(s.date).toLocaleDateString():"",l=s.requirements||"",d=s.slots??0,u=(s.status||"open").toUpperCase(),p=document.createElement("div");p.className="card",p.dataset.tryoutId=e,p.innerHTML=`<div class="badge">${u}</div>
      <h3 style="margin:6px 0 2px">
        ${n?`<a href="/p/#${encodeURIComponent(n)}">${i}</a>`:i}
      </h3>
      <div class="muted">${a} • ${c}</div>
      <p class="mt-3">${l}</p>
      <div class="mt-3">
        <button class="btn small apply-btn" data-id="${e}" data-org="${i}">Apply</button>
        <span class="muted" style="margin-left:10px">Slots: ${d}</span>
      </div>`,r.appendChild(p)}),h().then(s=>{const e=v(s);document.querySelectorAll(".apply-btn").forEach(i=>{e?i.addEventListener("click",n=>{const a=n.currentTarget;window.openApply(a.dataset.id,a.dataset.org)}):(i.textContent="Log in as Wrestler to apply",i.addEventListener("click",n=>{var a;n.preventDefault(),(a=document.querySelector("#login-btn"))==null||a.click()},{once:!0}))})})}function U(t){const r=document.querySelector("#app-list");r&&(r.innerHTML="",(t||[]).forEach(o=>{const s=o.reelLink||o.reel||"#",e=o.timestamp||o.created_at||o.createdAt||new Date().toISOString(),i=o.notes||"",n=o.applicantId?`Applicant: ${o.applicantId}`:"",a=document.createElement("div");a.className="card",a.innerHTML=`<div><strong>${n}</strong></div>
      <div class="mt-2"><a href="${s}" target="_blank" rel="noopener">Reel</a> • <span class="muted">${new Date(e).toLocaleString()}</span></div>
      <div class="mt-2">${i}</div>`,r.appendChild(a)}))}function Q(t,r){const o=document.querySelector("#apply-form");if(!o)return;o.tryout_id.value=t;const s=document.querySelector("#apply-title");s&&(s.textContent="Apply to "+r);const e=document.querySelector("#apply-modal");e&&e.showModal()}window.openApply=Q;async function X(){var e;const t=document.querySelector("#talent-search"),r=((e=document.querySelector("#talent-list"))==null?void 0:e.closest("section, .card, .panel"))||document.querySelector("#talent-list");if(!t)return;const o=await h();if(!w(o)){r?r.innerHTML=`
        <div class="card">
          <h2>Talent Search <span class="badge">Locked</span></h2>
          <p class="muted">Only promoters can search wrestler profiles. 
          <a href="#" data-auth="out" id="become-promoter">Create a free promoter account</a>.</p>
        </div>`:(t.closest("section, .card, .panel")||t).style.display="none";return}const s=async()=>{try{const i=E(t),n=new URLSearchParams;i.style&&i.style!=="any"&&n.set("style",i.style),i.city&&n.set("city",i.city),i.verified==="true"&&n.set("verified","true"),i.q&&n.set("q",i.q);const a=`/profiles/wrestlers${n.toString()?"?"+n.toString():""}`,c=await m(a);C(c)}catch(i){console.error(i),f("You must be a promoter to view talent profiles.","error"),C([])}};["input","change"].forEach(i=>t.addEventListener(i,s)),s()}async function q(){const t=document.querySelector("#tryout-list");if(t)try{const r=await m("/tryouts"),o=z(r);if(Z(o),location.hash){const s=location.hash.substring(1),e=document.querySelector(`[data-tryout-id="${s}"]`);e&&e.scrollIntoView({behavior:"smooth"})}}catch(r){if(String(r).includes("API 401")){t.innerHTML='<p class="muted">Please sign in to view tryouts.</p>';return}console.error(r),t.innerHTML='<p class="muted">Could not load tryouts.</p>'}}async function x(){if(document.querySelector("#app-list"))try{const o=new URL(location.href).searchParams.get("tryout"),s=o?`/applications?tryoutId=${encodeURIComponent(o)}`:"/applications",e=await m(s);U(e)}catch(r){console.error(r),U([])}}async function R(){const t=document.querySelector("#talent-form");t&&t.addEventListener("submit",async s=>{s.preventDefault();try{const e=E(t),i=(Array.isArray(e.styles)?e.styles:[e.styles]).filter(Boolean),n={name:e.name,ring:e.ring,city:e.city,travel:Number(e.travel||0),height_cm:Number(e.height_cm||0),weight_kg:Number(e.weight_kg||0),years:Number(e.years||0),school:e.school||"",styles:i,reel:e.reel||"",rate_min:Number(e.rate_min||0),rate_max:Number(e.rate_max||0),verified_school:!1};await m("/profiles/wrestlers",{method:"POST",body:n}),f("Talent profile saved!"),t.reset()}catch(e){console.error(e),f("Could not save profile","error")}});const r=document.querySelector("#tryout-form");r&&r.addEventListener("submit",async s=>{s.preventDefault();try{const e=E(r),i={orgName:e.org||"",city:e.city||"",date:e.date||"",slots:Number(e.slots||0),requirements:e.requirements||"",contact:e.contact||"",status:"open"};await m("/tryouts",{method:"POST",body:i}),f("Tryout posted!"),r.reset(),await q()}catch(e){console.error(e),f("Could not post tryout","error")}});const o=document.querySelector("#apply-form");o&&o.addEventListener("submit",async s=>{s.preventDefault();try{const e=E(o),i={tryoutId:e.tryout_id,notes:e.notes||"",reelLink:e.reel||""};await m("/applications",{method:"POST",body:i}),f("Application sent!"),o.reset();const n=document.querySelector("#apply-modal");n&&n.close(),await x()}catch(e){console.error(e),f("Could not submit application","error")}}),await Promise.all([X(),q(),x()])}document.addEventListener("DOMContentLoaded",R);window.addEventListener("auth:changed",R);(async function(){async function t(n){const a=await fetch(n,{cache:"no-cache"});if(!a.ok)throw new Error(`Failed to fetch ${n}: ${a.status}`);return await a.text()}function r(n){n.querySelectorAll("script").forEach(c=>{const l=document.createElement("script");for(const{name:d,value:u}of c.attributes)l.setAttribute(d,u);l.text=c.text,c.parentNode.replaceChild(l,c)})}async function o(n=document){let a=0;for(;;){const c=n.querySelectorAll("[data-include]");if(c.length===0)break;if(a++,await Promise.all(Array.from(c).map(async l=>{const d=l.getAttribute("data-include");try{const u=await t(d),p=document.createElement("div");p.innerHTML=u,l.replaceWith(...Array.from(p.childNodes)),r(document)}catch(u){console.error("Include failed for",d,u)}})),a>10){console.warn("include.js: stopping after 10 recursive passes to avoid loops");break}}}await o(),window.dispatchEvent(new Event("partials:ready"));try{const{applyRoleGatedUI:n}=await G(async()=>{const{applyRoleGatedUI:a}=await Promise.resolve().then(()=>Y);return{applyRoleGatedUI:a}},void 0);await n()}catch(n){console.error("roles.js load/apply failed",n)}(function(){const a=location.pathname.split("/").pop()||"index.html";document.querySelectorAll(".wu-links a").forEach(c=>{(c.getAttribute("href")||"").split("#")[0]===a&&c.classList.add("active")})})();const s=document.getElementById("nav-toggle"),e=document.getElementById("nav-links");s&&e&&s.addEventListener("click",()=>{const n=e.classList.toggle("open");s.setAttribute("aria-expanded",n?"true":"false")});const i=document.getElementById("year");i&&(i.textContent=new Date().getFullYear())})();async function ee(){const t=await h();if(!t)return null;if(v(t)){try{const r=await m("/profiles/wrestlers/me");if(r!=null&&r.handle)return`/w/${encodeURIComponent(r.handle)}`}catch{}return"/dashboard_wrestler.html"}if(w(t)){try{const r=await m("/profiles/promoters/me"),o=(r==null?void 0:r.handle)||(r==null?void 0:r.id)||(r==null?void 0:r.sub)||t.sub;if(o)return`/p/${encodeURIComponent(o)}`}catch{}return t.sub?`/p/${encodeURIComponent(t.sub)}`:"/dashboard_promoter.html"}return null}function N(){return Array.from(document.querySelectorAll("#nav-my-profile, #my-profile-link, [data-myprofile]"))}let g=0;async function y(){const t=N();if(!t.length){g<10&&(g++,setTimeout(y,200));return}const r=await ee();if(!r){g<10&&(g++,setTimeout(y,200));return}t.forEach(o=>{o.setAttribute("href",r);const s=e=>{e.preventDefault(),location.href=r};o.removeEventListener("click",o.__myprofileHandler),o.addEventListener("click",s),o.__myprofileHandler=s}),g=0}window.addEventListener("partials:ready",y);window.addEventListener("auth:changed",y);document.readyState==="loading"?document.addEventListener("DOMContentLoaded",y,{once:!0}):y();try{const t=window.WU_USER||JSON.parse(localStorage.getItem("wuUser")||"null");if(t&&t.handle){const r=t.role==="promoter"?`/p/${encodeURIComponent(t.handle)}`:`/w/${encodeURIComponent(t.handle)}`;N().forEach(o=>o.setAttribute("href",r))}}catch{}export{G as _,m as a,se as b,w as c,z as d,ne as e,h as g,v as i,ae as u};
