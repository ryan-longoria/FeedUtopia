import{Amplify as R}from"https://esm.sh/aws-amplify@6";import{fetchAuthSession as $}from"https://esm.sh/aws-amplify@6/auth";import{Hub as D}from"https://esm.sh/aws-amplify@6/utils";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(e){if(e.ep)return;e.ep=!0;const a=n(e);fetch(e.href,a)}})();window.WU_API="https://go2gft4394.execute-api.us-east-2.amazonaws.com";window.WU_MEDIA_BASE="https://d178p8k1vmj1zs.cloudfront.net";R.configure({Auth:{Cognito:{region:"us-east-2",userPoolId:"us-east-2_9oCzdeOZF",userPoolClientId:"6f4qoincbfm9g0lifod7q8nuhg",loginWith:{username:!1,email:!0,phone:!1},signUpVerificationMethod:"code"}}});const H="auth:changed";function A(t={}){window.dispatchEvent(new CustomEvent(H,{detail:t}))}D.listen("auth",({payload:t})=>{const{event:r}=t||{};["signedIn","signedOut","tokenRefresh"].includes(r)&&A({event:r})});(async()=>{try{await $()&&A({event:"initial"})}catch{A({event:"initial"})}})();function j(t,r){if(!t)throw new Error("WU_API base URL missing");return r?t.replace(/\/+$/,"")+"/"+String(r).replace(/^\/+/,""):t}async function F(){var r,n,o,e;const t=await $();return((n=(r=t==null?void 0:t.tokens)==null?void 0:r.idToken)==null?void 0:n.toString())||((e=(o=t==null?void 0:t.tokens)==null?void 0:o.accessToken)==null?void 0:e.toString())||""}async function f(t,{method:r="GET",body:n=null,headers:o={}}={}){const e=await F(),a={...o};e&&(a.Authorization=`Bearer ${e}`),n!=null&&(a["content-type"]="application/json");const s=n!=null,i=await fetch(j(window.WU_API,t),{method:r,headers:a,body:s?JSON.stringify(n):null});if(!i.ok){let l=i.statusText;try{const u=await i.text();if(u)try{l=JSON.parse(u).message||u}catch{l=u}}catch{}throw new Error(`API ${i.status}: ${l}`)}return i.status===204||i.status===205||i.status===304?null:(i.headers.get("content-type")||"").includes("application/json")?i.json():await i.text().catch(()=>"")||null}function B(t){return Array.isArray(t)?t:t&&Array.isArray(t.items)?t.items:[]}window.WU_API_READY=!0;const V="modulepreload",z=function(t){return"/"+t},k={},G=function(r,n,o){let e=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),i=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));e=Promise.allSettled(n.map(c=>{if(c=z(c),c in k)return;k[c]=!0;const l=c.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":V,l||(d.as="script"),d.crossOrigin="",d.href=c,i&&d.setAttribute("nonce",i),document.head.appendChild(d),l)return new Promise((m,v)=>{d.addEventListener("load",m),d.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(s){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=s,window.dispatchEvent(i),!i.defaultPrevented)throw s}return e.then(s=>{for(const i of s||[])i.status==="rejected"&&a(i.reason);return r().catch(a)})};async function y(){var t,r;try{const n=await $(),o=(r=(t=n==null?void 0:n.tokens)==null?void 0:t.idToken)==null?void 0:r.toString();if(!o)return{signedIn:!1,groups:[],role:null,sub:null};const e=JSON.parse(atob(o.split(".")[1])),a=Array.isArray(e["cognito:groups"])?e["cognito:groups"]:e["cognito:groups"]?String(e["cognito:groups"]).split(/[,\s]+/):[],s=(e["custom:role"]||"").toLowerCase(),i=s.startsWith("promo")?"Promoter":s.startsWith("wrestl")?"Wrestler":null,c=e.sub||null;return{signedIn:!0,groups:a,role:i,sub:c}}catch{return{signedIn:!1,groups:[],role:null,sub:null}}}const g=t=>{var r;return((r=t.groups)==null?void 0:r.includes("Promoters"))||t.role==="Promoter"},w=t=>{var r;return((r=t.groups)==null?void 0:r.includes("Wrestlers"))||t.role==="Wrestler"};async function J(){const t=await y();document.body.dataset.role=t.role||"",document.body.dataset.signedin=t.signedIn?"true":"false",document.querySelectorAll('[data-auth="in"]').forEach(o=>o.style.display=t.signedIn?"":"none"),document.querySelectorAll('[data-auth="out"]').forEach(o=>o.style.display=t.signedIn?"none":"");const r=g(t),n=w(t);return document.querySelectorAll('[data-requires="promoter"]').forEach(o=>o.style.display=r?"":"none"),document.querySelectorAll('[data-requires="wrestler"]').forEach(o=>o.style.display=n?"":"none"),t}(async()=>{const t=await y();(g(t)||w(t))&&document.body.classList.add("authenticated")})();const K=Object.freeze(Object.defineProperty({__proto__:null,applyRoleGatedUI:J,getAuthState:y,isPromoter:g,isWrestler:w},Symbol.toStringTag,{value:"Module"}));function S(t){const r=new FormData(t),n={};for(const[o,e]of r.entries())n[o]?Array.isArray(n[o])?n[o].push(e):n[o]=[n[o],e]:n[o]=e;return n}function p(t,r="success"){const n=document.querySelector("#toast");if(!n){r==="error"?console.error(t):console.log(t);return}n.textContent=t,n.classList.toggle("error",r==="error"),n.style.display="block",setTimeout(()=>n.style.display="none",2600)}window.toast=p;function T(t){const r=document.querySelector("#talent-list");if(!r)return;const n=Array.isArray(t)?t:t?[t]:[];r.innerHTML="";const o=e=>`https://picsum.photos/seed/${encodeURIComponent(e)}/200/200`;n.forEach((e,a)=>{var I;const s=e.ring||e.ringName||e.stageName||e.name||"Wrestler",i=e.name||"",c=e.years??e.yearsExperience??0,l=Array.isArray(e.styles)?e.styles:Array.isArray(e.gimmicks)?e.gimmicks:[],u=[e.city,e.region,e.country].filter(Boolean).join(", "),d=e.rate_min??e.rateMin??0,m=e.rate_max??e.rateMax??0,v=!!e.verified_school||!!e.verifiedSchool,L=e.reel||e.reelLink||"#",_=(e.photoKey&&window.WU_MEDIA_BASE?`${window.WU_MEDIA_BASE}/${e.photoKey}`:e.avatar)||o(s),b=document.createElement("div");b.className="card",b.innerHTML=`<div class="profile">
      <img src="${_}" alt="${s} profile"/>
      <div class="info">
        <div><strong>${s}</strong> <span class="muted">(${i})</span></div>
        <div class="mt-2">${u||"—"} • ${c} yrs • ${l.join(", ")}</div>
        <div class="mt-2">${v?'<span class="badge">Verified school</span>':""}</div>
        <div class="mt-2 muted">Rate: $${d}-${m}</div>
        <div class="mt-3" style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn small view-profile-btn" type="button">View Profile</button>
          ${e.handle?`<a class="btn small secondary" href="/w/#${encodeURIComponent(e.handle)}">See Full Profile</a>`:""}
        </div>
      </div>
    </div>`,(I=b.querySelector(".view-profile-btn"))==null||I.addEventListener("click",()=>{var q;const O=`
        <div style="display:grid;grid-template-columns:120px 1fr;gap:16px">
          <img src="${_}" alt="Avatar" style="width:120px;height:120px;border-radius:999px;object-fit:cover;background:#0f1224;border:1px solid #1f2546"/>
          <div>
            <h2 style="margin:0">${s}</h2>
            <div class="muted">${u||""}</div>
            <div class="chips mt-2">${l.map(W=>`<span class="chip">${W}</span>`).join("")}</div>
          </div>
        </div>
        <div class="mt-3">
          ${e.bio?`<p>${String(e.bio).replace(/\n/g,"<br/>")}</p>`:'<p class="muted">No bio yet.</p>'}
        </div>
        <dl class="mt-3">
          <dt class="muted">Name</dt><dd>${i}</dd>
          ${e.dob?`<dt class="muted mt-2">DOB</dt><dd>${e.dob}</dd>`:""}
          ${v?'<dt class="muted mt-2">School</dt><dd>Verified</dd>':""}
        </dl>
        ${L!=="#"?`<div class="mt-3"><a class="btn small secondary" href="${L}" target="_blank" rel="noopener">Watch Reel</a></div>`:""}
      `,P=document.getElementById("wm-content");P&&(P.innerHTML=O),(q=document.getElementById("wrestler-modal"))==null||q.showModal()}),r.appendChild(b)})}function Y(t){const r=document.querySelector("#tryout-list");if(!r)return;r.innerHTML="";const n=Array.isArray(t)?t:t?[t]:[];if(n.length===0){r.innerHTML='<p class="muted">No open tryouts yet.</p>';return}n.forEach(o=>{const e=o.tryoutId||o.id,a=o.orgName||o.org||"",s=o.ownerId||"",i=o.city||"",c=o.date?new Date(o.date).toLocaleDateString():"",l=o.requirements||"",u=o.slots??0,d=(o.status||"open").toUpperCase(),m=document.createElement("div");m.className="card",m.dataset.tryoutId=e,m.innerHTML=`<div class="badge">${d}</div>
      <h3 style="margin:6px 0 2px">
        ${s?`<a href="/p/#${encodeURIComponent(s)}">${a}</a>`:a}
      </h3>
      <div class="muted">${i} • ${c}</div>
      <p class="mt-3">${l}</p>
      <div class="mt-3">
        <button class="btn small apply-btn" data-id="${e}" data-org="${a}">Apply</button>
        <span class="muted" style="margin-left:10px">Slots: ${u}</span>
      </div>`,r.appendChild(m)}),y().then(o=>{const e=w(o);document.querySelectorAll(".apply-btn").forEach(a=>{e?a.addEventListener("click",s=>{const i=s.currentTarget;window.openApply(i.dataset.id,i.dataset.org)}):(a.textContent="Log in as Wrestler to apply",a.addEventListener("click",s=>{var i;s.preventDefault(),(i=document.querySelector("#login-btn"))==null||i.click()},{once:!0}))})})}function C(t){const r=document.querySelector("#app-list");r&&(r.innerHTML="",(t||[]).forEach(n=>{const o=n.reelLink||n.reel||"#",e=n.timestamp||n.created_at||n.createdAt||new Date().toISOString(),a=n.notes||"",s=n.applicantId?`Applicant: ${n.applicantId}`:"",i=document.createElement("div");i.className="card",i.innerHTML=`<div><strong>${s}</strong></div>
      <div class="mt-2"><a href="${o}" target="_blank" rel="noopener">Reel</a> • <span class="muted">${new Date(e).toLocaleString()}</span></div>
      <div class="mt-2">${a}</div>`,r.appendChild(i)}))}function Z(t,r){const n=document.querySelector("#apply-form");if(!n)return;n.tryout_id.value=t;const o=document.querySelector("#apply-title");o&&(o.textContent="Apply to "+r);const e=document.querySelector("#apply-modal");e&&e.showModal()}window.openApply=Z;async function Q(){var e;const t=document.querySelector("#talent-search"),r=((e=document.querySelector("#talent-list"))==null?void 0:e.closest("section, .card, .panel"))||document.querySelector("#talent-list");if(!t)return;const n=await y();if(!g(n)){r?r.innerHTML=`
        <div class="card">
          <h2>Talent Search <span class="badge">Locked</span></h2>
          <p class="muted">Only promoters can search wrestler profiles. 
          <a href="#" data-auth="out" id="become-promoter">Create a free promoter account</a>.</p>
        </div>`:(t.closest("section, .card, .panel")||t).style.display="none";return}const o=async()=>{try{const a=S(t),s=new URLSearchParams;a.style&&a.style!=="any"&&s.set("style",a.style),a.city&&s.set("city",a.city),a.verified==="true"&&s.set("verified","true"),a.q&&s.set("q",a.q);const i=`/profiles/wrestlers${s.toString()?"?"+s.toString():""}`,c=await f(i);T(c)}catch(a){console.error(a),p("You must be a promoter to view talent profiles.","error"),T([])}};["input","change"].forEach(a=>t.addEventListener(a,o)),o()}async function x(){const t=document.querySelector("#tryout-list");if(t)try{const r=await f("/tryouts"),n=B(r);if(Y(n),location.hash){const o=location.hash.substring(1),e=document.querySelector(`[data-tryout-id="${o}"]`);e&&e.scrollIntoView({behavior:"smooth"})}}catch(r){if(String(r).includes("API 401")){t.innerHTML='<p class="muted">Please sign in to view tryouts.</p>';return}console.error(r),t.innerHTML='<p class="muted">Could not load tryouts.</p>'}}async function U(){if(document.querySelector("#app-list"))try{const n=new URL(location.href).searchParams.get("tryout"),o=n?`/applications?tryoutId=${encodeURIComponent(n)}`:"/applications",e=await f(o);C(e)}catch(r){console.error(r),C([])}}async function M(){const t=document.querySelector("#talent-form");t&&t.addEventListener("submit",async o=>{o.preventDefault();try{const e=S(t),a=(Array.isArray(e.styles)?e.styles:[e.styles]).filter(Boolean),s={name:e.name,ring:e.ring,city:e.city,travel:Number(e.travel||0),height_cm:Number(e.height_cm||0),weight_kg:Number(e.weight_kg||0),years:Number(e.years||0),school:e.school||"",styles:a,reel:e.reel||"",rate_min:Number(e.rate_min||0),rate_max:Number(e.rate_max||0),verified_school:!1};await f("/profiles/wrestlers",{method:"POST",body:s}),p("Talent profile saved!"),t.reset()}catch(e){console.error(e),p("Could not save profile","error")}});const r=document.querySelector("#tryout-form");r&&r.addEventListener("submit",async o=>{o.preventDefault();try{const e=S(r),a={orgName:e.org||"",city:e.city||"",date:e.date||"",slots:Number(e.slots||0),requirements:e.requirements||"",contact:e.contact||"",status:"open"};await f("/tryouts",{method:"POST",body:a}),p("Tryout posted!"),r.reset(),await x()}catch(e){console.error(e),p("Could not post tryout","error")}});const n=document.querySelector("#apply-form");n&&n.addEventListener("submit",async o=>{o.preventDefault();try{const e=S(n),a={tryoutId:e.tryout_id,notes:e.notes||"",reelLink:e.reel||""};await f("/applications",{method:"POST",body:a}),p("Application sent!"),n.reset();const s=document.querySelector("#apply-modal");s&&s.close(),await U()}catch(e){console.error(e),p("Could not submit application","error")}}),await Promise.all([Q(),x(),U()])}document.addEventListener("DOMContentLoaded",M);window.addEventListener("auth:changed",M);(async function(){async function t(s){const i=await fetch(s,{cache:"no-cache"});if(!i.ok)throw new Error(`Failed to fetch ${s}: ${i.status}`);return await i.text()}function r(s){s.querySelectorAll("script").forEach(c=>{const l=document.createElement("script");for(const{name:u,value:d}of c.attributes)l.setAttribute(u,d);l.text=c.text,c.parentNode.replaceChild(l,c)})}async function n(s=document){let i=0;for(;;){const c=s.querySelectorAll("[data-include]");if(c.length===0)break;if(i++,await Promise.all(Array.from(c).map(async l=>{const u=l.getAttribute("data-include");try{const d=await t(u),m=document.createElement("div");m.innerHTML=d,l.replaceWith(...Array.from(m.childNodes)),r(document)}catch(d){console.error("Include failed for",u,d)}})),i>10){console.warn("include.js: stopping after 10 recursive passes to avoid loops");break}}}await n(),window.dispatchEvent(new Event("partials:ready"));try{const{applyRoleGatedUI:s}=await G(async()=>{const{applyRoleGatedUI:i}=await Promise.resolve().then(()=>K);return{applyRoleGatedUI:i}},void 0);await s()}catch(s){console.error("roles.js load/apply failed",s)}(function(){const i=location.pathname.split("/").pop()||"index.html";document.querySelectorAll(".wu-links a").forEach(c=>{(c.getAttribute("href")||"").split("#")[0]===i&&c.classList.add("active")})})();const o=document.getElementById("nav-toggle"),e=document.getElementById("nav-links");o&&e&&o.addEventListener("click",()=>{const s=e.classList.toggle("open");o.setAttribute("aria-expanded",s?"true":"false")});const a=document.getElementById("year");a&&(a.textContent=new Date().getFullYear())})();function h(t,r){return r?`/${t}/#${encodeURIComponent(r)}`:"#"}async function X(){const t=await y();if(!t)return"#";if(w(t)){try{const r=await f("/profiles/wrestlers/me");if(r!=null&&r.handle)return h("w",r.handle)}catch{}return"/dashboard_wrestler.html"}if(g(t)){try{const r=await f("/profiles/promoters/me"),n=(r==null?void 0:r.handle)||(r==null?void 0:r.id)||(r==null?void 0:r.sub)||t.sub;if(n)return h("p",n)}catch{}return t.sub?h("p",t.sub):"/dashboard_promoter.html"}return"#"}function N(){return Array.from(document.querySelectorAll("#nav-my-profile, #my-profile-link, [data-myprofile]"))}async function E(){const t=N();if(!t.length)return;const r=await X();!r||r==="#"||t.forEach(n=>{n.setAttribute("href",r);const o=e=>{(r.startsWith("/w/#")||r.startsWith("/p/#"))&&(e.preventDefault(),location.href=r)};n.removeEventListener("click",n.__myprofileHandler),n.addEventListener("click",o),n.__myprofileHandler=o})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",E,{once:!0}):E();window.addEventListener("auth:changed",E);try{const t=window.WU_USER||JSON.parse(localStorage.getItem("wuUser")||"null");if(t!=null&&t.handle){const r=t.role==="promoter"?h("p",t.handle):h("w",t.handle);N().forEach(n=>n.setAttribute("href",r))}}catch{}
