import{Amplify as D}from"https://esm.sh/aws-amplify@6";import{fetchAuthSession as A}from"https://esm.sh/aws-amplify@6/auth";import{Hub as W}from"https://esm.sh/aws-amplify@6/utils";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function o(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(t){if(t.ep)return;t.ep=!0;const i=o(t);fetch(t.href,i)}})();window.WU_API="https://go2gft4394.execute-api.us-east-2.amazonaws.com";window.WU_MEDIA_BASE="https://d178p8k1vmj1zs.cloudfront.net";D.configure({Auth:{Cognito:{region:"us-east-2",userPoolId:"us-east-2_9oCzdeOZF",userPoolClientId:"6f4qoincbfm9g0lifod7q8nuhg",loginWith:{username:!1,email:!0,phone:!1},signUpVerificationMethod:"code"}}});const B="auth:changed";function E(e={}){window.dispatchEvent(new CustomEvent(B,{detail:e}))}W.listen("auth",({payload:e})=>{const{event:r}=e||{};["signedIn","signedOut","tokenRefresh"].includes(r)&&E({event:r})});(async()=>{try{await A()&&E({event:"initial"})}catch{E({event:"initial"})}})();const nt=Object.freeze(Object.defineProperty({__proto__:null,fetchAuthSession:A},Symbol.toStringTag,{value:"Module"}));function H(e,r){if(!e)throw new Error("WU_API base URL missing");return r?e.replace(/\/+$/,"")+"/"+String(r).replace(/^\/+/,""):e}async function F(){var r,o,s,t;const e=await A();return((o=(r=e==null?void 0:e.tokens)==null?void 0:r.idToken)==null?void 0:o.toString())||((t=(s=e==null?void 0:e.tokens)==null?void 0:s.accessToken)==null?void 0:t.toString())||""}async function M(e){window.SparkMD5||await new Promise((a,c)=>{const l=document.createElement("script");l.src="https://cdn.jsdelivr.net/npm/spark-md5@3.0.2/spark-md5.min.js",l.onload=a,l.onerror=c,document.head.appendChild(l)});const r=2*1024*1024,o=Math.ceil(e.size/r),s=new window.SparkMD5.ArrayBuffer;for(let a=0;a<o;a++){const c=await e.slice(a*r,Math.min((a+1)*r,e.size)).arrayBuffer();s.append(c)}const t=s.end(),i=new Uint8Array(t.length/2);for(let a=0;a<i.length;a++)i[a]=parseInt(t.substr(a*2,2),16);let n="";for(let a=0;a<i.length;a++)n+=String.fromCharCode(i[a]);return btoa(n)}async function m(e,{method:r="GET",body:o=null,headers:s={}}={}){const t=await F(),i={...s};t&&(i.Authorization=`Bearer ${t}`),o!=null&&(i["content-type"]="application/json");const n=o!=null,a=await fetch(H(window.WU_API,e),{method:r,headers:i,body:n?JSON.stringify(o):null});if(!a.ok){let l=a.statusText;try{const d=await a.text();if(d)try{l=JSON.parse(d).message||d}catch{l=d}}catch{}throw new Error(`API ${a.status}: ${l}`)}return a.status===204||a.status===205||a.status===304?null:(a.headers.get("content-type")||"").includes("application/json")?a.json():await a.text().catch(()=>"")||null}async function st(e){const r=await M(e),o=await m(`/profiles/wrestlers/me/photo-url?contentType=${encodeURIComponent(e.type||"application/octet-stream")}`,{method:"POST",headers:{"Content-MD5":r}}),s=o==null?void 0:o.uploadUrl,t=o==null?void 0:o.objectKey,i=(o==null?void 0:o.contentType)||e.type||"application/octet-stream";if(!s||!t)throw new Error("presign failed");const n=await fetch(s,{method:"PUT",headers:{"Content-Type":i,"x-amz-server-side-encryption":"AES256","Content-MD5":r},body:e});if(!n.ok)throw new Error(`S3 upload failed ${n.status}: ${await n.text().catch(()=>n.statusText)}`);return t}async function at(e,r,o,s={}){const t=await M(o),i=new URLSearchParams({key:e||"upload.bin",contentType:r||"application/octet-stream"});s.actor&&i.set("actor",String(s.actor)),s.type&&i.set("type",String(s.type));const n=await m(`/s3/presign?${i.toString()}`,{method:"GET",headers:{"Content-MD5":t}}),a=(n==null?void 0:n.uploadUrl)||(n==null?void 0:n.url)||(n==null?void 0:n.signedUrl),c=(n==null?void 0:n.objectKey)||(n==null?void 0:n.key),l=(n==null?void 0:n.contentType)||r||"application/octet-stream";if(!a||!c)throw console.error("presign response:",n),new Error("Failed to get presigned URL (missing uploadUrl/objectKey)");const d=await fetch(a,{method:"PUT",headers:{"Content-Type":l,"x-amz-server-side-encryption":"AES256","Content-MD5":t},body:o});if(!d.ok){const u=await d.text().catch(()=>"");throw new Error(`S3 upload failed ${d.status}: ${u||d.statusText}`)}return c}function z(e){return Array.isArray(e)?e:e&&Array.isArray(e.items)?e.items:[]}window.WU_API_READY=!0;const K="modulepreload",V=function(e){return"/"+e},I={},G=function(r,o,s){let t=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),a=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));t=Promise.allSettled(o.map(c=>{if(c=V(c),c in I)return;I[c]=!0;const l=c.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":K,l||(u.as="script"),u.crossOrigin="",u.href=c,a&&u.setAttribute("nonce",a),document.head.appendChild(u),l)return new Promise((p,v)=>{u.addEventListener("load",p),u.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(n){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=n,window.dispatchEvent(a),!a.defaultPrevented)throw n}return t.then(n=>{for(const a of n||[])a.status==="rejected"&&i(a.reason);return r().catch(i)})};async function y(){var e,r;try{const o=await A(),s=(r=(e=o==null?void 0:o.tokens)==null?void 0:e.idToken)==null?void 0:r.toString();if(!s)return{signedIn:!1,groups:[],role:null,sub:null};const t=JSON.parse(atob(s.split(".")[1])),i=Array.isArray(t["cognito:groups"])?t["cognito:groups"]:t["cognito:groups"]?String(t["cognito:groups"]).split(/[,\s]+/):[],n=(t["custom:role"]||"").toLowerCase(),a=n.startsWith("promo")?"Promoter":n.startsWith("wrestl")?"Wrestler":null,c=t.sub||null;return{signedIn:!0,groups:i,role:a,sub:c}}catch{return{signedIn:!1,groups:[],role:null,sub:null}}}const g=e=>{var r;return((r=e.groups)==null?void 0:r.includes("Promoters"))||e.role==="Promoter"},w=e=>{var r;return((r=e.groups)==null?void 0:r.includes("Wrestlers"))||e.role==="Wrestler"};async function J(){const e=await y();document.body.dataset.role=e.role||"",document.body.dataset.signedin=e.signedIn?"true":"false",document.querySelectorAll('[data-auth="in"]').forEach(s=>s.style.display=e.signedIn?"":"none"),document.querySelectorAll('[data-auth="out"]').forEach(s=>s.style.display=e.signedIn?"none":"");const r=g(e),o=w(e);return document.querySelectorAll('[data-requires="promoter"]').forEach(s=>s.style.display=r?"":"none"),document.querySelectorAll('[data-requires="wrestler"]').forEach(s=>s.style.display=o?"":"none"),e}(async()=>{const e=await y();(g(e)||w(e))&&document.body.classList.add("authenticated")})();const Y=Object.freeze(Object.defineProperty({__proto__:null,applyRoleGatedUI:J,getAuthState:y,isPromoter:g,isWrestler:w},Symbol.toStringTag,{value:"Module"}));function S(e){const r=new FormData(e),o={};for(const[s,t]of r.entries())o[s]?Array.isArray(o[s])?o[s].push(t):o[s]=[o[s],t]:o[s]=t;return o}function f(e,r="success"){const o=document.querySelector("#toast");if(!o){r==="error"?console.error(e):console.log(e);return}o.textContent=e,o.classList.toggle("error",r==="error"),o.style.display="block",setTimeout(()=>o.style.display="none",2600)}window.toast=f;function q(e){const r=document.querySelector("#talent-list");if(!r)return;const o=Array.isArray(e)?e:e?[e]:[];r.innerHTML="";const s=t=>`https://picsum.photos/seed/${encodeURIComponent(t)}/200/200`;o.forEach((t,i)=>{var k;const n=t.ring||t.ringName||t.stageName||t.name||"Wrestler",a=t.name||"",c=t.years??t.yearsExperience??0,l=Array.isArray(t.styles)?t.styles:Array.isArray(t.gimmicks)?t.gimmicks:[],d=[t.city,t.region,t.country].filter(Boolean).join(", "),u=t.rate_min??t.rateMin??0,p=t.rate_max??t.rateMax??0,v=!!t.verified_school||!!t.verifiedSchool,L=t.reel||t.reelLink||"#",_=(t.photoKey&&window.WU_MEDIA_BASE?`${window.WU_MEDIA_BASE}/${t.photoKey}`:t.avatar)||s(n),b=document.createElement("div");b.className="card",b.innerHTML=`<div class="profile">
      <img src="${_}" alt="${n} profile"/>
      <div class="info">
        <div><strong>${n}</strong> <span class="muted">(${a})</span></div>
        <div class="mt-2">${d||"—"} • ${c} yrs • ${l.join(", ")}</div>
        <div class="mt-2">${v?'<span class="badge">Verified school</span>':""}</div>
        <div class="mt-2 muted">Rate: $${u}-${p}</div>
        <div class="mt-3" style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn small view-profile-btn" type="button">View Profile</button>
          ${t.handle?`<a class="btn small secondary" href="/w/#${encodeURIComponent(t.handle)}">See Full Profile</a>`:""}
        </div>
      </div>
    </div>`,(k=b.querySelector(".view-profile-btn"))==null||k.addEventListener("click",()=>{var T;const R=`
        <div style="display:grid;grid-template-columns:120px 1fr;gap:16px">
          <img src="${_}" alt="Avatar" style="width:120px;height:120px;border-radius:999px;object-fit:cover;background:#0f1224;border:1px solid #1f2546"/>
          <div>
            <h2 style="margin:0">${n}</h2>
            <div class="muted">${d||""}</div>
            <div class="chips mt-2">${l.map(j=>`<span class="chip">${j}</span>`).join("")}</div>
          </div>
        </div>
        <div class="mt-3">
          ${t.bio?`<p>${String(t.bio).replace(/\n/g,"<br/>")}</p>`:'<p class="muted">No bio yet.</p>'}
        </div>
        <dl class="mt-3">
          <dt class="muted">Name</dt><dd>${a}</dd>
          ${t.dob?`<dt class="muted mt-2">DOB</dt><dd>${t.dob}</dd>`:""}
          ${v?'<dt class="muted mt-2">School</dt><dd>Verified</dd>':""}
        </dl>
        ${L!=="#"?`<div class="mt-3"><a class="btn small secondary" href="${L}" target="_blank" rel="noopener">Watch Reel</a></div>`:""}
      `,P=document.getElementById("wm-content");P&&(P.innerHTML=R),(T=document.getElementById("wrestler-modal"))==null||T.showModal()}),r.appendChild(b)})}function Z(e){const r=document.querySelector("#tryout-list");if(!r)return;r.innerHTML="";const o=Array.isArray(e)?e:e?[e]:[];if(o.length===0){r.innerHTML='<p class="muted">No open tryouts yet.</p>';return}o.forEach(s=>{const t=s.tryoutId||s.id,i=s.orgName||s.org||"",n=s.ownerId||"",a=s.city||"",c=s.date?new Date(s.date).toLocaleDateString():"",l=s.requirements||"",d=s.slots??0,u=(s.status||"open").toUpperCase(),p=document.createElement("div");p.className="card",p.dataset.tryoutId=t,p.innerHTML=`<div class="badge">${u}</div>
      <h3 style="margin:6px 0 2px">
        ${n?`<a href="/p/#${encodeURIComponent(n)}">${i}</a>`:i}
      </h3>
      <div class="muted">${a} • ${c}</div>
      <p class="mt-3">${l}</p>
      <div class="mt-3">
        <button class="btn small apply-btn" data-id="${t}" data-org="${i}">Apply</button>
        <span class="muted" style="margin-left:10px">Slots: ${d}</span>
      </div>`,r.appendChild(p)}),y().then(s=>{const t=w(s);document.querySelectorAll(".apply-btn").forEach(i=>{t?i.addEventListener("click",n=>{const a=n.currentTarget;window.openApply(a.dataset.id,a.dataset.org)}):(i.textContent="Log in as Wrestler to apply",i.addEventListener("click",n=>{var a;n.preventDefault(),(a=document.querySelector("#login-btn"))==null||a.click()},{once:!0}))})})}function C(e){const r=document.querySelector("#app-list");r&&(r.innerHTML="",(e||[]).forEach(o=>{const s=o.reelLink||o.reel||"#",t=o.timestamp||o.created_at||o.createdAt||new Date().toISOString(),i=o.notes||"",n=o.applicantId?`Applicant: ${o.applicantId}`:"",a=document.createElement("div");a.className="card",a.innerHTML=`<div><strong>${n}</strong></div>
      <div class="mt-2"><a href="${s}" target="_blank" rel="noopener">Reel</a> • <span class="muted">${new Date(t).toLocaleString()}</span></div>
      <div class="mt-2">${i}</div>`,r.appendChild(a)}))}function Q(e,r){const o=document.querySelector("#apply-form");if(!o)return;o.tryout_id.value=e;const s=document.querySelector("#apply-title");s&&(s.textContent="Apply to "+r);const t=document.querySelector("#apply-modal");t&&t.showModal()}window.openApply=Q;async function X(){var t;const e=document.querySelector("#talent-search"),r=((t=document.querySelector("#talent-list"))==null?void 0:t.closest("section, .card, .panel"))||document.querySelector("#talent-list");if(!e)return;const o=await y();if(!g(o)){r?r.innerHTML=`
        <div class="card">
          <h2>Talent Search <span class="badge">Locked</span></h2>
          <p class="muted">Only promoters can search wrestler profiles. 
          <a href="#" data-auth="out" id="become-promoter">Create a free promoter account</a>.</p>
        </div>`:(e.closest("section, .card, .panel")||e).style.display="none";return}const s=async()=>{try{const i=S(e),n=new URLSearchParams;i.style&&i.style!=="any"&&n.set("style",i.style),i.city&&n.set("city",i.city),i.verified==="true"&&n.set("verified","true"),i.q&&n.set("q",i.q);const a=`/profiles/wrestlers${n.toString()?"?"+n.toString():""}`,c=await m(a);q(c)}catch(i){console.error(i),f("You must be a promoter to view talent profiles.","error"),q([])}};["input","change"].forEach(i=>e.addEventListener(i,s)),s()}async function U(){const e=document.querySelector("#tryout-list");if(e)try{const r=await m("/tryouts"),o=z(r);if(Z(o),location.hash){const s=location.hash.substring(1),t=document.querySelector(`[data-tryout-id="${s}"]`);t&&t.scrollIntoView({behavior:"smooth"})}}catch(r){if(String(r).includes("API 401")){e.innerHTML='<p class="muted">Please sign in to view tryouts.</p>';return}console.error(r),e.innerHTML='<p class="muted">Could not load tryouts.</p>'}}async function x(){if(document.querySelector("#app-list"))try{const o=new URL(location.href).searchParams.get("tryout"),s=o?`/applications?tryoutId=${encodeURIComponent(o)}`:"/applications",t=await m(s);C(t)}catch(r){console.error(r),C([])}}async function N(){const e=document.querySelector("#talent-form");e&&e.addEventListener("submit",async s=>{s.preventDefault();try{const t=S(e),i=(Array.isArray(t.styles)?t.styles:[t.styles]).filter(Boolean),n={name:t.name,ring:t.ring,city:t.city,travel:Number(t.travel||0),height_cm:Number(t.height_cm||0),weight_kg:Number(t.weight_kg||0),years:Number(t.years||0),school:t.school||"",styles:i,reel:t.reel||"",rate_min:Number(t.rate_min||0),rate_max:Number(t.rate_max||0),verified_school:!1};await m("/profiles/wrestlers",{method:"POST",body:n}),f("Talent profile saved!"),e.reset()}catch(t){console.error(t),f("Could not save profile","error")}});const r=document.querySelector("#tryout-form");r&&r.addEventListener("submit",async s=>{s.preventDefault();try{const t=S(r),i={orgName:t.org||"",city:t.city||"",date:t.date||"",slots:Number(t.slots||0),requirements:t.requirements||"",contact:t.contact||"",status:"open"};await m("/tryouts",{method:"POST",body:i}),f("Tryout posted!"),r.reset(),await U()}catch(t){console.error(t),f("Could not post tryout","error")}});const o=document.querySelector("#apply-form");o&&o.addEventListener("submit",async s=>{s.preventDefault();try{const t=S(o),i={tryoutId:t.tryout_id,notes:t.notes||"",reelLink:t.reel||""};await m("/applications",{method:"POST",body:i}),f("Application sent!"),o.reset();const n=document.querySelector("#apply-modal");n&&n.close(),await x()}catch(t){console.error(t),f("Could not submit application","error")}}),await Promise.all([X(),U(),x()])}document.addEventListener("DOMContentLoaded",N);window.addEventListener("auth:changed",N);(async function(){async function e(n){const a=await fetch(n,{cache:"no-cache"});if(!a.ok)throw new Error(`Failed to fetch ${n}: ${a.status}`);return await a.text()}function r(n){n.querySelectorAll("script").forEach(c=>{const l=document.createElement("script");for(const{name:d,value:u}of c.attributes)l.setAttribute(d,u);l.text=c.text,c.parentNode.replaceChild(l,c)})}async function o(n=document){let a=0;for(;;){const c=n.querySelectorAll("[data-include]");if(c.length===0)break;if(a++,await Promise.all(Array.from(c).map(async l=>{const d=l.getAttribute("data-include");try{const u=await e(d),p=document.createElement("div");p.innerHTML=u,l.replaceWith(...Array.from(p.childNodes)),r(document)}catch(u){console.error("Include failed for",d,u)}})),a>10){console.warn("include.js: stopping after 10 recursive passes to avoid loops");break}}}await o(),window.dispatchEvent(new Event("partials:ready"));try{const{applyRoleGatedUI:n}=await G(async()=>{const{applyRoleGatedUI:a}=await Promise.resolve().then(()=>Y);return{applyRoleGatedUI:a}},void 0);await n()}catch(n){console.error("roles.js load/apply failed",n)}(function(){const a=location.pathname.split("/").pop()||"index.html";document.querySelectorAll(".wu-links a").forEach(c=>{(c.getAttribute("href")||"").split("#")[0]===a&&c.classList.add("active")})})();const s=document.getElementById("nav-toggle"),t=document.getElementById("nav-links");s&&t&&s.addEventListener("click",()=>{const n=t.classList.toggle("open");s.setAttribute("aria-expanded",n?"true":"false")});const i=document.getElementById("year");i&&(i.textContent=new Date().getFullYear())})();function h(e,r){return r?`/${e}/#${encodeURIComponent(r)}`:"#"}async function tt(){const e=await y();if(!e)return"#";if(w(e)){try{const r=await m("/profiles/wrestlers/me");if(r!=null&&r.handle)return h("w",r.handle)}catch{}return"/dashboard_wrestler.html"}if(g(e)){try{const r=await m("/profiles/promoters/me"),o=(r==null?void 0:r.handle)||(r==null?void 0:r.id)||(r==null?void 0:r.sub)||e.sub;if(o)return h("p",o)}catch{}return e.sub?h("p",e.sub):"/dashboard_promoter.html"}return"#"}function O(){return Array.from(document.querySelectorAll("#nav-my-profile, #my-profile-link, [data-myprofile]"))}async function $(){const e=O();if(!e.length)return;const r=await tt();!r||r==="#"||e.forEach(o=>{o.setAttribute("href",r);const s=t=>{(r.startsWith("/w/#")||r.startsWith("/p/#"))&&(t.preventDefault(),location.href=r)};o.removeEventListener("click",o.__myprofileHandler),o.addEventListener("click",s),o.__myprofileHandler=s})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",$,{once:!0}):$();window.addEventListener("auth:changed",$);try{const e=window.WU_USER||JSON.parse(localStorage.getItem("wuUser")||"null");if(e!=null&&e.handle){const r=e.role==="promoter"?h("p",e.handle):h("w",e.handle);O().forEach(o=>o.setAttribute("href",r))}}catch{}export{G as _,m as a,st as b,g as c,z as d,nt as e,y as g,w as i,at as u};
