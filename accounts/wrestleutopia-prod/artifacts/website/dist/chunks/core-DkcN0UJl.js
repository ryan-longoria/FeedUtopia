import{Amplify as O}from"https://esm.sh/aws-amplify@6";import{fetchAuthSession as A}from"https://esm.sh/aws-amplify@6/auth";import{Hub as j}from"https://esm.sh/aws-amplify@6/utils";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const c of e)if(c.type==="childList")for(const n of c.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function o(e){const c={};return e.integrity&&(c.integrity=e.integrity),e.referrerPolicy&&(c.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?c.credentials="include":e.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(e){if(e.ep)return;e.ep=!0;const c=o(e);fetch(e.href,c)}})();window.WU_API="https://go2gft4394.execute-api.us-east-2.amazonaws.com";window.WU_MEDIA_BASE="https://d178p8k1vmj1zs.cloudfront.net";O.configure({Auth:{Cognito:{region:"us-east-2",userPoolId:"us-east-2_9oCzdeOZF",userPoolClientId:"6f4qoincbfm9g0lifod7q8nuhg",loginWith:{username:!1,email:!0,phone:!1},signUpVerificationMethod:"code"}}});const D="auth:changed";function W(t={}){window.dispatchEvent(new CustomEvent(D,{detail:t}))}j.listen("auth",({payload:t})=>{const{event:r}=t||{};["signedIn","signedOut","tokenRefresh"].includes(r)&&W({event:r})});const oe=Object.freeze(Object.defineProperty({__proto__:null,fetchAuthSession:A},Symbol.toStringTag,{value:"Module"}));function B(t,r){if(!t)throw new Error("WU_API base URL missing");return r?t.replace(/\/+$/,"")+"/"+String(r).replace(/^\/+/,""):t}async function F(){var r,o,s,e;const t=await A();return((o=(r=t==null?void 0:t.tokens)==null?void 0:r.idToken)==null?void 0:o.toString())||((e=(s=t==null?void 0:t.tokens)==null?void 0:s.accessToken)==null?void 0:e.toString())||""}async function q(t){window.SparkMD5||await new Promise((a,i)=>{const l=document.createElement("script");l.src="https://cdn.jsdelivr.net/npm/spark-md5@3.0.2/spark-md5.min.js",l.onload=a,l.onerror=i,document.head.appendChild(l)});const r=2*1024*1024,o=Math.ceil(t.size/r),s=new window.SparkMD5.ArrayBuffer;for(let a=0;a<o;a++){const i=await t.slice(a*r,Math.min((a+1)*r,t.size)).arrayBuffer();s.append(i)}const e=s.end(),c=new Uint8Array(e.length/2);for(let a=0;a<c.length;a++)c[a]=parseInt(e.substr(a*2,2),16);let n="";for(let a=0;a<c.length;a++)n+=String.fromCharCode(c[a]);return btoa(n)}async function m(t,{method:r="GET",body:o=null,headers:s={}}={}){const e=await F(),c={...s};e&&(c.Authorization=`Bearer ${e}`),o!=null&&(c["content-type"]="application/json");const n=o!=null,a=await fetch(B(window.WU_API,t),{method:r,headers:c,body:n?JSON.stringify(o):null});if(!a.ok){let l=a.statusText;try{const d=await a.text();if(d)try{l=JSON.parse(d).message||d}catch{l=d}}catch{}throw new Error(`API ${a.status}: ${l}`)}return a.status===204||a.status===205||a.status===304?null:(a.headers.get("content-type")||"").includes("application/json")?a.json():await a.text().catch(()=>"")||null}async function ne(t){const r=await q(t),o=await m(`/profiles/wrestlers/me/photo-url?contentType=${encodeURIComponent(t.type||"application/octet-stream")}`,{method:"POST",headers:{"Content-MD5":r}}),s=o==null?void 0:o.uploadUrl,e=o==null?void 0:o.objectKey,c=(o==null?void 0:o.contentType)||t.type||"application/octet-stream";if(!s||!e)throw new Error("presign failed");const n=await fetch(s,{method:"PUT",headers:{"Content-Type":c,"x-amz-server-side-encryption":"AES256","Content-MD5":r},body:t});if(!n.ok)throw new Error(`S3 upload failed ${n.status}: ${await n.text().catch(()=>n.statusText)}`);return e}async function se(t,r,o,s={}){const e=await q(o),c=new URLSearchParams({key:t||"upload.bin",contentType:r||"application/octet-stream"});s.actor&&c.set("actor",String(s.actor)),s.type&&c.set("type",String(s.type));const n=await m(`/s3/presign?${c.toString()}`,{method:"GET",headers:{"Content-MD5":e}}),a=(n==null?void 0:n.uploadUrl)||(n==null?void 0:n.url)||(n==null?void 0:n.signedUrl),i=(n==null?void 0:n.objectKey)||(n==null?void 0:n.key),l=(n==null?void 0:n.contentType)||r||"application/octet-stream";if(!a||!i)throw console.error("presign response:",n),new Error("Failed to get presigned URL (missing uploadUrl/objectKey)");const d=await fetch(a,{method:"PUT",headers:{"Content-Type":l,"x-amz-server-side-encryption":"AES256","Content-MD5":e},body:o});if(!d.ok){const u=await d.text().catch(()=>"");throw new Error(`S3 upload failed ${d.status}: ${u||d.statusText}`)}return i}function H(t){return Array.isArray(t)?t:t&&Array.isArray(t.items)?t.items:[]}window.WU_API_READY=!0;const z="modulepreload",K=function(t){return"/"+t},k={},V=function(r,o,s){let e=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),a=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));e=Promise.allSettled(o.map(i=>{if(i=K(i),i in k)return;k[i]=!0;const l=i.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${d}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":z,l||(u.as="script"),u.crossOrigin="",u.href=i,a&&u.setAttribute("nonce",a),document.head.appendChild(u),l)return new Promise((p,w)=>{u.addEventListener("load",p),u.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${i}`)))})}))}function c(n){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=n,window.dispatchEvent(a),!a.defaultPrevented)throw n}return e.then(n=>{for(const a of n||[])a.status==="rejected"&&c(a.reason);return r().catch(c)})};async function y(){var t,r;try{const o=await A(),s=(r=(t=o==null?void 0:o.tokens)==null?void 0:t.idToken)==null?void 0:r.toString();if(!s)return{signedIn:!1,groups:[],role:null,sub:null};const e=JSON.parse(atob(s.split(".")[1])),c=Array.isArray(e["cognito:groups"])?e["cognito:groups"]:e["cognito:groups"]?String(e["cognito:groups"]).split(/[,\s]+/):[],n=(e["custom:role"]||"").toLowerCase(),a=n.startsWith("promo")?"Promoter":n.startsWith("wrestl")?"Wrestler":null,i=e.sub||null;return{signedIn:!0,groups:c,role:a,sub:i}}catch{return{signedIn:!1,groups:[],role:null,sub:null}}}const h=t=>{var r;return((r=t.groups)==null?void 0:r.includes("Promoters"))||t.role==="Promoter"},g=t=>{var r;return((r=t.groups)==null?void 0:r.includes("Wrestlers"))||t.role==="Wrestler"};async function G(){const t=await y();document.body.dataset.role=t.role||"",document.body.dataset.signedin=t.signedIn?"true":"false",document.querySelectorAll('[data-auth="in"]').forEach(s=>s.style.display=t.signedIn?"":"none"),document.querySelectorAll('[data-auth="out"]').forEach(s=>s.style.display=t.signedIn?"none":"");const r=h(t),o=g(t);return document.querySelectorAll('[data-requires="promoter"]').forEach(s=>s.style.display=r?"":"none"),document.querySelectorAll('[data-requires="wrestler"]').forEach(s=>s.style.display=o?"":"none"),t}(async()=>{const t=await y();(h(t)||g(t))&&document.body.classList.add("authenticated")})();const J=Object.freeze(Object.defineProperty({__proto__:null,applyRoleGatedUI:G,getAuthState:y,isPromoter:h,isWrestler:g},Symbol.toStringTag,{value:"Module"}));function b(t){const r=new FormData(t),o={};for(const[s,e]of r.entries())o[s]?Array.isArray(o[s])?o[s].push(e):o[s]=[o[s],e]:o[s]=e;return o}function f(t,r="success"){const o=document.querySelector("#toast");if(!o){r==="error"?console.error(t):console.log(t);return}o.textContent=t,o.classList.toggle("error",r==="error"),o.style.display="block",setTimeout(()=>o.style.display="none",2600)}window.toast=f;function P(t){const r=document.querySelector("#talent-list");if(!r)return;const o=Array.isArray(t)?t:t?[t]:[];r.innerHTML="";const s=e=>`https://picsum.photos/seed/${encodeURIComponent(e)}/200/200`;o.forEach((e,c)=>{var L;const n=e.ring||e.ringName||e.stageName||e.name||"Wrestler",a=e.name||"",i=e.years??e.yearsExperience??0,l=Array.isArray(e.styles)?e.styles:Array.isArray(e.gimmicks)?e.gimmicks:[],d=[e.city,e.region,e.country].filter(Boolean).join(", "),u=e.rate_min??e.rateMin??0,p=e.rate_max??e.rateMax??0,w=!!e.verified_school||!!e.verifiedSchool,E=e.reel||e.reelLink||"#",$=(e.photoKey&&window.WU_MEDIA_BASE?`${window.WU_MEDIA_BASE}/${e.photoKey}`:e.avatar)||s(n),v=document.createElement("div");v.className="card",v.innerHTML=`<div class="profile">
      <img src="${$}" alt="${n} profile"/>
      <div class="info">
        <div><strong>${n}</strong> <span class="muted">(${a})</span></div>
        <div class="mt-2">${d||"—"} • ${i} yrs • ${l.join(", ")}</div>
        <div class="mt-2">${w?'<span class="badge">Verified school</span>':""}</div>
        <div class="mt-2 muted">Rate: $${u}-${p}</div>
        <div class="mt-3" style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn small view-profile-btn" type="button">View Profile</button>
          ${e.handle?`<a class="btn small secondary" href="/w/#${encodeURIComponent(e.handle)}">See Full Profile</a>`:""}
        </div>
      </div>
    </div>`,(L=v.querySelector(".view-profile-btn"))==null||L.addEventListener("click",()=>{var _;const R=`
        <div style="display:grid;grid-template-columns:120px 1fr;gap:16px">
          <img src="${$}" alt="Avatar" style="width:120px;height:120px;border-radius:999px;object-fit:cover;background:#0f1224;border:1px solid #1f2546"/>
          <div>
            <h2 style="margin:0">${n}</h2>
            <div class="muted">${d||""}</div>
            <div class="chips mt-2">${l.map(N=>`<span class="chip">${N}</span>`).join("")}</div>
          </div>
        </div>
        <div class="mt-3">
          ${e.bio?`<p>${String(e.bio).replace(/\n/g,"<br/>")}</p>`:'<p class="muted">No bio yet.</p>'}
        </div>
        <dl class="mt-3">
          <dt class="muted">Name</dt><dd>${a}</dd>
          ${e.dob?`<dt class="muted mt-2">DOB</dt><dd>${e.dob}</dd>`:""}
          ${w?'<dt class="muted mt-2">School</dt><dd>Verified</dd>':""}
        </dl>
        ${E!=="#"?`<div class="mt-3"><a class="btn small secondary" href="${E}" target="_blank" rel="noopener">Watch Reel</a></div>`:""}
      `,I=document.getElementById("wm-content");I&&(I.innerHTML=R),(_=document.getElementById("wrestler-modal"))==null||_.showModal()}),r.appendChild(v)})}function Y(t){const r=document.querySelector("#tryout-list");if(!r)return;r.innerHTML="";const o=Array.isArray(t)?t:t?[t]:[];if(o.length===0){r.innerHTML='<p class="muted">No open tryouts yet.</p>';return}o.forEach(s=>{const e=s.tryoutId||s.id,c=s.orgName||s.org||"",n=s.ownerId||"",a=s.city||"",i=s.date?new Date(s.date).toLocaleDateString():"",l=s.requirements||"",d=s.slots??0,u=(s.status||"open").toUpperCase(),p=document.createElement("div");p.className="card",p.dataset.tryoutId=e,p.innerHTML=`<div class="badge">${u}</div>
      <h3 style="margin:6px 0 2px">
        ${n?`<a href="/p/#${encodeURIComponent(n)}">${c}</a>`:c}
      </h3>
      <div class="muted">${a} • ${i}</div>
      <p class="mt-3">${l}</p>
      <div class="mt-3">
        <button class="btn small apply-btn" data-id="${e}" data-org="${c}">Apply</button>
        <span class="muted" style="margin-left:10px">Slots: ${d}</span>
      </div>`,r.appendChild(p)}),y().then(s=>{const e=g(s);document.querySelectorAll(".apply-btn").forEach(c=>{e?c.addEventListener("click",n=>{const a=n.currentTarget;window.openApply(a.dataset.id,a.dataset.org)}):(c.textContent="Log in as Wrestler to apply",c.addEventListener("click",n=>{var a;n.preventDefault(),(a=document.querySelector("#login-btn"))==null||a.click()},{once:!0}))})})}function T(t){const r=document.querySelector("#app-list");r&&(r.innerHTML="",(t||[]).forEach(o=>{const s=o.reelLink||o.reel||"#",e=o.timestamp||o.created_at||o.createdAt||new Date().toISOString(),c=o.notes||"",n=o.applicantId?`Applicant: ${o.applicantId}`:"",a=document.createElement("div");a.className="card",a.innerHTML=`<div><strong>${n}</strong></div>
      <div class="mt-2"><a href="${s}" target="_blank" rel="noopener">Reel</a> • <span class="muted">${new Date(e).toLocaleString()}</span></div>
      <div class="mt-2">${c}</div>`,r.appendChild(a)}))}function Z(t,r){const o=document.querySelector("#apply-form");if(!o)return;o.tryout_id.value=t;const s=document.querySelector("#apply-title");s&&(s.textContent="Apply to "+r);const e=document.querySelector("#apply-modal");e&&e.showModal()}window.openApply=Z;async function Q(){var e;const t=document.querySelector("#talent-search"),r=((e=document.querySelector("#talent-list"))==null?void 0:e.closest("section, .card, .panel"))||document.querySelector("#talent-list");if(!t)return;const o=await y();if(!h(o)){r?r.innerHTML=`
        <div class="card">
          <h2>Talent Search <span class="badge">Locked</span></h2>
          <p class="muted">Only promoters can search wrestler profiles. 
          <a href="#" data-auth="out" id="become-promoter">Create a free promoter account</a>.</p>
        </div>`:(t.closest("section, .card, .panel")||t).style.display="none";return}const s=async()=>{try{const c=b(t),n=new URLSearchParams;c.style&&c.style!=="any"&&n.set("style",c.style),c.city&&n.set("city",c.city),c.verified==="true"&&n.set("verified","true"),c.q&&n.set("q",c.q);const a=`/profiles/wrestlers${n.toString()?"?"+n.toString():""}`,i=await m(a);P(i)}catch(c){console.error(c),f("You must be a promoter to view talent profiles.","error"),P([])}};["input","change"].forEach(c=>t.addEventListener(c,s)),s()}async function C(){const t=document.querySelector("#tryout-list");if(t)try{const r=await m("/tryouts"),o=H(r);if(Y(o),location.hash){const s=location.hash.substring(1),e=document.querySelector(`[data-tryout-id="${s}"]`);e&&e.scrollIntoView({behavior:"smooth"})}}catch(r){if(String(r).includes("API 401")){t.innerHTML='<p class="muted">Please sign in to view tryouts.</p>';return}console.error(r),t.innerHTML='<p class="muted">Could not load tryouts.</p>'}}async function U(){if(document.querySelector("#app-list"))try{const o=new URL(location.href).searchParams.get("tryout"),s=o?`/applications?tryoutId=${encodeURIComponent(o)}`:"/applications",e=await m(s);T(e)}catch(r){console.error(r),T([])}}async function x(){const t=document.querySelector("#talent-form");t&&t.addEventListener("submit",async s=>{s.preventDefault();try{const e=b(t),c=(Array.isArray(e.styles)?e.styles:[e.styles]).filter(Boolean),n={name:e.name,ring:e.ring,city:e.city,travel:Number(e.travel||0),height_cm:Number(e.height_cm||0),weight_kg:Number(e.weight_kg||0),years:Number(e.years||0),school:e.school||"",styles:c,reel:e.reel||"",rate_min:Number(e.rate_min||0),rate_max:Number(e.rate_max||0),verified_school:!1};await m("/profiles/wrestlers",{method:"POST",body:n}),f("Talent profile saved!"),t.reset()}catch(e){console.error(e),f("Could not save profile","error")}});const r=document.querySelector("#tryout-form");r&&r.addEventListener("submit",async s=>{s.preventDefault();try{const e=b(r),c={orgName:e.org||"",city:e.city||"",date:e.date||"",slots:Number(e.slots||0),requirements:e.requirements||"",contact:e.contact||"",status:"open"};await m("/tryouts",{method:"POST",body:c}),f("Tryout posted!"),r.reset(),await C()}catch(e){console.error(e),f("Could not post tryout","error")}});const o=document.querySelector("#apply-form");o&&o.addEventListener("submit",async s=>{s.preventDefault();try{const e=b(o),c={tryoutId:e.tryout_id,notes:e.notes||"",reelLink:e.reel||""};await m("/applications",{method:"POST",body:c}),f("Application sent!"),o.reset();const n=document.querySelector("#apply-modal");n&&n.close(),await U()}catch(e){console.error(e),f("Could not submit application","error")}}),await Promise.all([Q(),C(),U()])}document.addEventListener("DOMContentLoaded",x);window.addEventListener("auth:changed",x);(async function(){async function t(n){const a=await fetch(n,{cache:"no-cache"});if(!a.ok)throw new Error(`Failed to fetch ${n}: ${a.status}`);return await a.text()}function r(n){n.querySelectorAll("script").forEach(i=>{const l=document.createElement("script");for(const{name:d,value:u}of i.attributes)l.setAttribute(d,u);l.text=i.text,i.parentNode.replaceChild(l,i)})}async function o(n=document){let a=0;for(;;){const i=n.querySelectorAll("[data-include]");if(i.length===0)break;if(a++,await Promise.all(Array.from(i).map(async l=>{const d=l.getAttribute("data-include");try{const u=await t(d),p=document.createElement("div");p.innerHTML=u,l.replaceWith(...Array.from(p.childNodes)),r(document)}catch(u){console.error("Include failed for",d,u)}})),a>10){console.warn("include.js: stopping after 10 recursive passes to avoid loops");break}}}await o();try{const{applyRoleGatedUI:n}=await V(async()=>{const{applyRoleGatedUI:a}=await Promise.resolve().then(()=>J);return{applyRoleGatedUI:a}},void 0);await n()}catch(n){console.error("roles.js load/apply failed",n)}(function(){const a=location.pathname.split("/").pop()||"index.html";document.querySelectorAll(".wu-links a").forEach(i=>{(i.getAttribute("href")||"").split("#")[0]===a&&i.classList.add("active")})})();const s=document.getElementById("nav-toggle"),e=document.getElementById("nav-links");s&&e&&s.addEventListener("click",()=>{const n=e.classList.toggle("open");s.setAttribute("aria-expanded",n?"true":"false")});const c=document.getElementById("year");c&&(c.textContent=new Date().getFullYear())})();async function X(){const t=await y();if(!t)return"#";if(g(t)){try{const r=await m("/profiles/wrestlers/me");if(r!=null&&r.handle)return`/w/#${encodeURIComponent(r.handle)}`}catch{}return"/dashboard_wrestler.html"}if(h(t)){try{const r=await m("/profiles/promoters/me"),o=(r==null?void 0:r.handle)||(r==null?void 0:r.id)||(r==null?void 0:r.sub)||t.sub;if(o)return`/p/#${encodeURIComponent(o)}`}catch{}return t.sub?`/p/#${encodeURIComponent(t.sub)}`:"/dashboard_promoter.html"}return"#"}function M(){return Array.from(document.querySelectorAll("#nav-my-profile, #my-profile-link, [data-myprofile]"))}async function S(){const t=M();if(!t.length)return;const r=await X();!r||r==="#"||t.forEach(o=>{o.setAttribute("href",r);const s=e=>{e.preventDefault(),location.href=r};o.removeEventListener("click",o.__myprofileHandler),o.addEventListener("click",s),o.__myprofileHandler=s})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",S,{once:!0}):S();window.addEventListener("auth:changed",S);try{const t=window.WU_USER||JSON.parse(localStorage.getItem("wuUser")||"null");if(t&&t.handle){const r=t.role==="promoter"?`/p/#${encodeURIComponent(t.handle)}`:`/w/#${encodeURIComponent(t.handle)}`;M().forEach(o=>o.setAttribute("href",r))}}catch{}export{V as _,m as a,ne as b,h as c,H as d,oe as e,y as g,g as i,se as u};
