import{Amplify as g}from"https://esm.sh/aws-amplify@6";import{fetchAuthSession as a}from"https://esm.sh/aws-amplify@6/auth";import{Hub as p}from"https://esm.sh/aws-amplify@6/utils";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(t){if(t.ep)return;t.ep=!0;const s=n(t);fetch(t.href,s)}})();g.configure({Auth:{Cognito:{region:"us-east-2",userPoolId:"us-east-2_9oCzdeOZF",userPoolClientId:"6f4qoincbfm9g0lifod7q8nuhg",loginWith:{username:!1,email:!0,phone:!1},signUpVerificationMethod:"code"}}});const m="auth:changed";function y(e={}){window.dispatchEvent(new CustomEvent(m,{detail:e}))}p.listen("auth",({payload:e})=>{const{event:o}=e||{};["signedIn","signedOut","tokenRefresh"].includes(o)&&y({event:o})});const O=Object.freeze(Object.defineProperty({__proto__:null,fetchAuthSession:a},Symbol.toStringTag,{value:"Module"}));async function l(){var e,o;try{const n=await a(),r=(o=(e=n==null?void 0:n.tokens)==null?void 0:e.idToken)==null?void 0:o.toString();if(!r)return{signedIn:!1,groups:[],role:null,sub:null};const t=JSON.parse(atob(r.split(".")[1])),s=Array.isArray(t["cognito:groups"])?t["cognito:groups"]:t["cognito:groups"]?String(t["cognito:groups"]).split(/[,\s]+/):[],i=(t["custom:role"]||"").toLowerCase(),d=i.startsWith("promo")?"Promoter":i.startsWith("wrestl")?"Wrestler":null,f=t.sub||null;return{signedIn:!0,groups:s,role:d,sub:f}}catch{return{signedIn:!1,groups:[],role:null,sub:null}}}const u=e=>{var o;return((o=e.groups)==null?void 0:o.includes("Promoters"))||e.role==="Promoter"},c=e=>{var o;return((o=e.groups)==null?void 0:o.includes("Wrestlers"))||e.role==="Wrestler"};async function h(){const e=await l();document.body.dataset.role=e.role||"",document.body.dataset.signedin=e.signedIn?"true":"false",document.querySelectorAll('[data-auth="in"]').forEach(r=>r.style.display=e.signedIn?"":"none"),document.querySelectorAll('[data-auth="out"]').forEach(r=>r.style.display=e.signedIn?"none":"");const o=u(e),n=c(e);return document.querySelectorAll('[data-requires="promoter"]').forEach(r=>r.style.display=o?"":"none"),document.querySelectorAll('[data-requires="wrestler"]').forEach(r=>r.style.display=n?"":"none"),e}(async()=>{const e=await l();(u(e)||c(e))&&document.body.classList.add("authenticated")})();const P=Object.freeze(Object.defineProperty({__proto__:null,applyRoleGatedUI:h,getAuthState:l,isPromoter:u,isWrestler:c},Symbol.toStringTag,{value:"Module"}));export{c as a,O as b,l as g,u as i,P as r};
