import{Amplify as N}from"https://esm.sh/aws-amplify@6";import{fetchAuthSession as S}from"https://esm.sh/aws-amplify@6/auth";import{Hub as j}from"https://esm.sh/aws-amplify@6/utils";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const c of e)if(c.type==="childList")for(const o of c.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(e){const c={};return e.integrity&&(c.integrity=e.integrity),e.referrerPolicy&&(c.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?c.credentials="include":e.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(e){if(e.ep)return;e.ep=!0;const c=r(e);fetch(e.href,c)}})();window.WU_API="https://go2gft4394.execute-api.us-east-2.amazonaws.com";window.WU_MEDIA_BASE="https://d178p8k1vmj1zs.cloudfront.net";N.configure({Auth:{Cognito:{region:"us-east-2",userPoolId:"us-east-2_9oCzdeOZF",userPoolClientId:"6f4qoincbfm9g0lifod7q8nuhg",loginWith:{username:!1,email:!0,phone:!1},signUpVerificationMethod:"code"}}});const O="auth:changed";function R(t={}){window.dispatchEvent(new CustomEvent(O,{detail:t}))}j.listen("auth",({payload:t})=>{const{event:n}=t||{};["signedIn","signedOut","tokenRefresh"].includes(n)&&R({event:n})});const ee=Object.freeze(Object.defineProperty({__proto__:null,fetchAuthSession:S},Symbol.toStringTag,{value:"Module"}));function D(t,n){if(!t)throw new Error("WU_API base URL missing");return n?t.replace(/\/+$/,"")+"/"+String(n).replace(/^\/+/,""):t}async function W(){var n,r,s,e;const t=await S();return((r=(n=t==null?void 0:t.tokens)==null?void 0:n.idToken)==null?void 0:r.toString())||((e=(s=t==null?void 0:t.tokens)==null?void 0:s.accessToken)==null?void 0:e.toString())||""}async function C(t){window.SparkMD5||await new Promise((a,i)=>{const l=document.createElement("script");l.src="https://cdn.jsdelivr.net/npm/spark-md5@3.0.2/spark-md5.min.js",l.onload=a,l.onerror=i,document.head.appendChild(l)});const n=2*1024*1024,r=Math.ceil(t.size/n),s=new window.SparkMD5.ArrayBuffer;for(let a=0;a<r;a++){const i=await t.slice(a*n,Math.min((a+1)*n,t.size)).arrayBuffer();s.append(i)}const e=s.end(),c=new Uint8Array(e.length/2);for(let a=0;a<c.length;a++)c[a]=parseInt(e.substr(a*2,2),16);let o="";for(let a=0;a<c.length;a++)o+=String.fromCharCode(c[a]);return btoa(o)}async function y(t,{method:n="GET",body:r=null,headers:s={}}={}){const e=await W(),c={...s};e&&(c.Authorization=`Bearer ${e}`),r!=null&&(c["content-type"]="application/json");const o=r!=null,a=await fetch(D(window.WU_API,t),{method:n,headers:c,body:o?JSON.stringify(r):null});if(!a.ok){let l=a.statusText;try{const d=await a.text();if(d)try{l=JSON.parse(d).message||d}catch{l=d}}catch{}throw new Error(`API ${a.status}: ${l}`)}return a.status===204||a.status===205||a.status===304?null:(a.headers.get("content-type")||"").includes("application/json")?a.json():await a.text().catch(()=>"")||null}async function te(t){const n=await C(t),r=await y(`/profiles/wrestlers/me/photo-url?contentType=${encodeURIComponent(t.type||"application/octet-stream")}`,{method:"POST",headers:{"Content-MD5":n}}),s=r==null?void 0:r.uploadUrl,e=r==null?void 0:r.objectKey,c=(r==null?void 0:r.contentType)||t.type||"application/octet-stream";if(!s||!e)throw new Error("presign failed");const o=await fetch(s,{method:"PUT",headers:{"Content-Type":c,"x-amz-server-side-encryption":"AES256","Content-MD5":n},body:t});if(!o.ok)throw new Error(`S3 upload failed ${o.status}: ${await o.text().catch(()=>o.statusText)}`);return e}async function oe(t,n,r,s={}){const e=await C(r),c=new URLSearchParams({key:t||"upload.bin",contentType:n||"application/octet-stream"});s.actor&&c.set("actor",String(s.actor)),s.type&&c.set("type",String(s.type));const o=await y(`/s3/presign?${c.toString()}`,{method:"GET",headers:{"Content-MD5":e}}),a=(o==null?void 0:o.uploadUrl)||(o==null?void 0:o.url)||(o==null?void 0:o.signedUrl),i=(o==null?void 0:o.objectKey)||(o==null?void 0:o.key),l=(o==null?void 0:o.contentType)||n||"application/octet-stream";if(!a||!i)throw console.error("presign response:",o),new Error("Failed to get presigned URL (missing uploadUrl/objectKey)");const d=await fetch(a,{method:"PUT",headers:{"Content-Type":l,"x-amz-server-side-encryption":"AES256","Content-MD5":e},body:r});if(!d.ok){const u=await d.text().catch(()=>"");throw new Error(`S3 upload failed ${d.status}: ${u||d.statusText}`)}return i}function B(t){return Array.isArray(t)?t:t&&Array.isArray(t.items)?t.items:[]}window.WU_API_READY=!0;const F="modulepreload",H=function(t){return"/"+t},P={},z=function(n,r,s){let e=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));e=Promise.allSettled(r.map(i=>{if(i=H(i),i in P)return;P[i]=!0;const l=i.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${d}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":F,l||(u.as="script"),u.crossOrigin="",u.href=i,a&&u.setAttribute("nonce",a),document.head.appendChild(u),l)return new Promise((m,h)=>{u.addEventListener("load",m),u.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${i}`)))})}))}function c(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return e.then(o=>{for(const a of o||[])a.status==="rejected"&&c(a.reason);return n().catch(c)})};async function f(){var t,n;try{const r=await S(),s=(n=(t=r==null?void 0:r.tokens)==null?void 0:t.idToken)==null?void 0:n.toString();if(!s)return{signedIn:!1,groups:[],role:null,sub:null};const e=JSON.parse(atob(s.split(".")[1])),c=Array.isArray(e["cognito:groups"])?e["cognito:groups"]:e["cognito:groups"]?String(e["cognito:groups"]).split(/[,\s]+/):[],o=(e["custom:role"]||"").toLowerCase(),a=o.startsWith("promo")?"Promoter":o.startsWith("wrestl")?"Wrestler":null,i=e.sub||null;return{signedIn:!0,groups:c,role:a,sub:i}}catch{return{signedIn:!1,groups:[],role:null,sub:null}}}const v=t=>{var n;return((n=t.groups)==null?void 0:n.includes("Promoters"))||t.role==="Promoter"},b=t=>{var n;return((n=t.groups)==null?void 0:n.includes("Wrestlers"))||t.role==="Wrestler"};async function K(){const t=await f();document.body.dataset.role=t.role||"",document.body.dataset.signedin=t.signedIn?"true":"false",document.querySelectorAll('[data-auth="in"]').forEach(s=>s.style.display=t.signedIn?"":"none"),document.querySelectorAll('[data-auth="out"]').forEach(s=>s.style.display=t.signedIn?"none":"");const n=v(t),r=b(t);return document.querySelectorAll('[data-requires="promoter"]').forEach(s=>s.style.display=n?"":"none"),document.querySelectorAll('[data-requires="wrestler"]').forEach(s=>s.style.display=r?"":"none"),t}(async()=>{const t=await f();(v(t)||b(t))&&document.body.classList.add("authenticated")})();const V=Object.freeze(Object.defineProperty({__proto__:null,applyRoleGatedUI:K,getAuthState:f,isPromoter:v,isWrestler:b},Symbol.toStringTag,{value:"Module"}));function w(t){const n=new FormData(t),r={};for(const[s,e]of n.entries())r[s]?Array.isArray(r[s])?r[s].push(e):r[s]=[r[s],e]:r[s]=e;return r}function p(t,n="success"){const r=document.querySelector("#toast");if(!r){n==="error"?console.error(t):console.log(t);return}r.textContent=t,r.classList.toggle("error",n==="error"),r.style.display="block",setTimeout(()=>r.style.display="none",2600)}window.toast=p;function I(t){const n=document.querySelector("#talent-list");if(!n)return;const r=Array.isArray(t)?t:t?[t]:[];n.innerHTML="";const s=e=>`https://picsum.photos/seed/${encodeURIComponent(e)}/200/200`;r.forEach((e,c)=>{var $;const o=e.ring||e.ringName||e.stageName||e.name||"Wrestler",a=e.name||"",i=e.years??e.yearsExperience??0,l=Array.isArray(e.styles)?e.styles:Array.isArray(e.gimmicks)?e.gimmicks:[],d=[e.city,e.region,e.country].filter(Boolean).join(", "),u=e.rate_min??e.rateMin??0,m=e.rate_max??e.rateMax??0,h=!!e.verified_school||!!e.verifiedSchool,A=e.reel||e.reelLink||"#",E=(e.photoKey&&window.WU_MEDIA_BASE?`${window.WU_MEDIA_BASE}/${e.photoKey}`:e.avatar)||s(o),g=document.createElement("div");g.className="card",g.innerHTML=`<div class="profile">
      <img src="${E}" alt="${o} profile"/>
      <div class="info">
        <div><strong>${o}</strong> <span class="muted">(${a})</span></div>
        <div class="mt-2">${d||"—"} • ${i} yrs • ${l.join(", ")}</div>
        <div class="mt-2">${h?'<span class="badge">Verified school</span>':""}</div>
        <div class="mt-2 muted">Rate: $${u}-${m}</div>
        <div class="mt-3" style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn small view-profile-btn" type="button">View Profile</button>
          ${e.handle?`<a class="btn small secondary" href="/w/#${encodeURIComponent(e.handle)}">See Full Profile</a>`:""}
        </div>
      </div>
    </div>`,($=g.querySelector(".view-profile-btn"))==null||$.addEventListener("click",()=>{var T;const U=`
        <div style="display:grid;grid-template-columns:120px 1fr;gap:16px">
          <img src="${E}" alt="Avatar" style="width:120px;height:120px;border-radius:999px;object-fit:cover;background:#0f1224;border:1px solid #1f2546"/>
          <div>
            <h2 style="margin:0">${o}</h2>
            <div class="muted">${d||""}</div>
            <div class="chips mt-2">${l.map(M=>`<span class="chip">${M}</span>`).join("")}</div>
          </div>
        </div>
        <div class="mt-3">
          ${e.bio?`<p>${String(e.bio).replace(/\n/g,"<br/>")}</p>`:'<p class="muted">No bio yet.</p>'}
        </div>
        <dl class="mt-3">
          <dt class="muted">Name</dt><dd>${a}</dd>
          ${e.dob?`<dt class="muted mt-2">DOB</dt><dd>${e.dob}</dd>`:""}
          ${h?'<dt class="muted mt-2">School</dt><dd>Verified</dd>':""}
        </dl>
        ${A!=="#"?`<div class="mt-3"><a class="btn small secondary" href="${A}" target="_blank" rel="noopener">Watch Reel</a></div>`:""}
      `,L=document.getElementById("wm-content");L&&(L.innerHTML=U),(T=document.getElementById("wrestler-modal"))==null||T.showModal()}),n.appendChild(g)})}function G(t){const n=document.querySelector("#tryout-list");if(!n)return;n.innerHTML="";const r=Array.isArray(t)?t:t?[t]:[];if(r.length===0){n.innerHTML='<p class="muted">No open tryouts yet.</p>';return}r.forEach(s=>{const e=s.tryoutId||s.id,c=s.orgName||s.org||"",o=s.ownerId||"",a=s.city||"",i=s.date?new Date(s.date).toLocaleDateString():"",l=s.requirements||"",d=s.slots??0,u=(s.status||"open").toUpperCase(),m=document.createElement("div");m.className="card",m.dataset.tryoutId=e,m.innerHTML=`<div class="badge">${u}</div>
      <h3 style="margin:6px 0 2px">
        ${o?`<a href="/p/#${encodeURIComponent(o)}">${c}</a>`:c}
      </h3>
      <div class="muted">${a} • ${i}</div>
      <p class="mt-3">${l}</p>
      <div class="mt-3">
        <button class="btn small apply-btn" data-id="${e}" data-org="${c}">Apply</button>
        <span class="muted" style="margin-left:10px">Slots: ${d}</span>
      </div>`,n.appendChild(m)}),f().then(s=>{const e=b(s);document.querySelectorAll(".apply-btn").forEach(c=>{e?c.addEventListener("click",o=>{const a=o.currentTarget;window.openApply(a.dataset.id,a.dataset.org)}):(c.textContent="Log in as Wrestler to apply",c.addEventListener("click",o=>{var a;o.preventDefault(),(a=document.querySelector("#login-btn"))==null||a.click()},{once:!0}))})})}function k(t){const n=document.querySelector("#app-list");n&&(n.innerHTML="",(t||[]).forEach(r=>{const s=r.reelLink||r.reel||"#",e=r.timestamp||r.created_at||r.createdAt||new Date().toISOString(),c=r.notes||"",o=r.applicantId?`Applicant: ${r.applicantId}`:"",a=document.createElement("div");a.className="card",a.innerHTML=`<div><strong>${o}</strong></div>
      <div class="mt-2"><a href="${s}" target="_blank" rel="noopener">Reel</a> • <span class="muted">${new Date(e).toLocaleString()}</span></div>
      <div class="mt-2">${c}</div>`,n.appendChild(a)}))}function J(t,n){const r=document.querySelector("#apply-form");if(!r)return;r.tryout_id.value=t;const s=document.querySelector("#apply-title");s&&(s.textContent="Apply to "+n);const e=document.querySelector("#apply-modal");e&&e.showModal()}window.openApply=J;async function Y(){var e;const t=document.querySelector("#talent-search"),n=((e=document.querySelector("#talent-list"))==null?void 0:e.closest("section, .card, .panel"))||document.querySelector("#talent-list");if(!t)return;const r=await f();if(!v(r)){n?n.innerHTML=`
        <div class="card">
          <h2>Talent Search <span class="badge">Locked</span></h2>
          <p class="muted">Only promoters can search wrestler profiles. 
          <a href="#" data-auth="out" id="become-promoter">Create a free promoter account</a>.</p>
        </div>`:(t.closest("section, .card, .panel")||t).style.display="none";return}const s=async()=>{try{const c=w(t),o=new URLSearchParams;c.style&&c.style!=="any"&&o.set("style",c.style),c.city&&o.set("city",c.city),c.verified==="true"&&o.set("verified","true"),c.q&&o.set("q",c.q);const a=`/profiles/wrestlers${o.toString()?"?"+o.toString():""}`,i=await y(a);I(i)}catch(c){console.error(c),p("You must be a promoter to view talent profiles.","error"),I([])}};["input","change"].forEach(c=>t.addEventListener(c,s)),s()}async function _(){const t=document.querySelector("#tryout-list");if(t)try{const n=await y("/tryouts"),r=B(n);if(G(r),location.hash){const s=location.hash.substring(1),e=document.querySelector(`[data-tryout-id="${s}"]`);e&&e.scrollIntoView({behavior:"smooth"})}}catch(n){if(String(n).includes("API 401")){t.innerHTML='<p class="muted">Please sign in to view tryouts.</p>';return}console.error(n),t.innerHTML='<p class="muted">Could not load tryouts.</p>'}}async function q(){if(document.querySelector("#app-list"))try{const r=new URL(location.href).searchParams.get("tryout"),s=r?`/applications?tryoutId=${encodeURIComponent(r)}`:"/applications",e=await y(s);k(e)}catch(n){console.error(n),k([])}}async function x(){const t=document.querySelector("#talent-form");t&&t.addEventListener("submit",async s=>{s.preventDefault();try{const e=w(t),c=(Array.isArray(e.styles)?e.styles:[e.styles]).filter(Boolean),o={name:e.name,ring:e.ring,city:e.city,travel:Number(e.travel||0),height_cm:Number(e.height_cm||0),weight_kg:Number(e.weight_kg||0),years:Number(e.years||0),school:e.school||"",styles:c,reel:e.reel||"",rate_min:Number(e.rate_min||0),rate_max:Number(e.rate_max||0),verified_school:!1};await y("/profiles/wrestlers",{method:"POST",body:o}),p("Talent profile saved!"),t.reset()}catch(e){console.error(e),p("Could not save profile","error")}});const n=document.querySelector("#tryout-form");n&&n.addEventListener("submit",async s=>{s.preventDefault();try{const e=w(n),c={orgName:e.org||"",city:e.city||"",date:e.date||"",slots:Number(e.slots||0),requirements:e.requirements||"",contact:e.contact||"",status:"open"};await y("/tryouts",{method:"POST",body:c}),p("Tryout posted!"),n.reset(),await _()}catch(e){console.error(e),p("Could not post tryout","error")}});const r=document.querySelector("#apply-form");r&&r.addEventListener("submit",async s=>{s.preventDefault();try{const e=w(r),c={tryoutId:e.tryout_id,notes:e.notes||"",reelLink:e.reel||""};await y("/applications",{method:"POST",body:c}),p("Application sent!"),r.reset();const o=document.querySelector("#apply-modal");o&&o.close(),await q()}catch(e){console.error(e),p("Could not submit application","error")}}),await Promise.all([Y(),_(),q()])}document.addEventListener("DOMContentLoaded",x);window.addEventListener("auth:changed",x);(async function(){async function t(o){const a=await fetch(o,{cache:"no-cache"});if(!a.ok)throw new Error(`Failed to fetch ${o}: ${a.status}`);return await a.text()}function n(o){o.querySelectorAll("script").forEach(i=>{const l=document.createElement("script");for(const{name:d,value:u}of i.attributes)l.setAttribute(d,u);l.text=i.text,i.parentNode.replaceChild(l,i)})}async function r(o=document){let a=0;for(;;){const i=o.querySelectorAll("[data-include]");if(i.length===0)break;if(a++,await Promise.all(Array.from(i).map(async l=>{const d=l.getAttribute("data-include");try{const u=await t(d),m=document.createElement("div");m.innerHTML=u,l.replaceWith(...Array.from(m.childNodes)),n(document)}catch(u){console.error("Include failed for",d,u)}})),a>10){console.warn("include.js: stopping after 10 recursive passes to avoid loops");break}}}await r();try{const{applyRoleGatedUI:o}=await z(async()=>{const{applyRoleGatedUI:a}=await Promise.resolve().then(()=>V);return{applyRoleGatedUI:a}},void 0);await o()}catch(o){console.error("roles.js load/apply failed",o)}(function(){const a=location.pathname.split("/").pop()||"index.html";document.querySelectorAll(".wu-links a").forEach(i=>{(i.getAttribute("href")||"").split("#")[0]===a&&i.classList.add("active")})})();const s=document.getElementById("nav-toggle"),e=document.getElementById("nav-links");s&&e&&s.addEventListener("click",()=>{const o=e.classList.toggle("open");s.setAttribute("aria-expanded",o?"true":"false")});const c=document.getElementById("year");c&&(c.textContent=new Date().getFullYear())})();export{z as _,b as a,y as b,te as c,B as d,ee as e,f as g,v as i,oe as u};
