import{g as p,u as w,a as h,i as j,m as A}from"./chunks/core-DMEOCLyK.js";import{m as v}from"./chunks/media-zB9oTFcx.js";import"https://esm.sh/aws-amplify@6";import"https://esm.sh/aws-amplify@6/auth";import"https://esm.sh/aws-amplify@6/utils";const l=(t,e="")=>{const o=document.getElementById(t);o&&(o.value=e??"")},d=t=>{var e;return(((e=document.getElementById(t))==null?void 0:e.value)??"").trim()},P=(t,e,o="Savingâ€¦")=>{t&&(t.disabled=!!e,e?(t.dataset.prevText=t.textContent,t.textContent=o):t.textContent=t.dataset.prevText||t.textContent)};function K(t,e){if(!t)return null;let o=String(t).trim();if(o.startsWith("s3://")){o=o.slice(5);const s=o.indexOf("/");o=s>=0?o.slice(s+1):o}if(/^(public\/(wrestlers|promoters)\/|raw\/uploads\/)/.test(o)||/^user\//.test(o))return o;const a=o.split("/").pop()||`file-${Date.now()}`;return e?`user/${e}/${a}`:`user/unknown/${a}`}function f(t,e="success"){const o=document.querySelector("#toast");if(!o)return console[e==="error"?"error":"log"](t);o.textContent=t,o.classList.toggle("error",e==="error"),o.style.display="block",setTimeout(()=>o.style.display="none",2400)}(window.WU_MEDIA_BASE||"").replace(/\/+$/,"");const $=(t,e)=>{if(!t)return;if(!e){t.src="/assets/avatar-fallback.svg";return}const o=v(String(e)),a=/^public\/promoters\/profiles\//.test(String(e))||/^profiles\//.test(String(e));t.src=a?`${o}?v=${Date.now()}`:o};let y=[],u=[];function E(){const t=document.getElementById("photoGrid");t&&(t.innerHTML=(y||[]).map((e,o)=>`
      <div class="media-card">
        <img src="${typeof e=="string"&&e.startsWith("raw/")?"/assets/image-processing.svg":v(e)}" alt="">
        <button class="btn secondary media-remove" type="button" data-i="${o}">Remove</button>
      </div>
    `).join(""))}function b(){const t=document.getElementById("highlightList");t&&(t.innerHTML=(u||[]).map((e,o)=>`
    <li>
      <span style="flex:1; word-break:break-all">${e}</span>
      <button class="btn secondary" type="button" data-i="${o}">Remove</button>
    </li>
  `).join(""),wrap.querySelectorAll(".media-remove").forEach(e=>{e.onclick=()=>{y.splice(Number(e.dataset.i),1),E()}}),t.querySelectorAll("button").forEach(e=>{e.onclick=()=>{u.splice(Number(e.dataset.i),1),b()}}))}async function U(){var e,o;const t=(o=(e=document.getElementById("logo"))==null?void 0:e.files)==null?void 0:o[0];if(!t)return null;try{const a=await A(t);if(typeof h=="function"){const s=await h("/profiles/promoters/me/logo-url",{method:"POST",headers:{"Content-MD5":a},body:{contentType:t.type||"image/jpeg"}});if(s!=null&&s.uploadUrl&&(s!=null&&s.objectKey))return await fetch(s.uploadUrl,{method:"PUT",headers:{"Content-Type":s.contentType||t.type||"image/jpeg","x-amz-server-side-encryption":"AES256","Content-MD5":a},body:t}),s.objectKey}}catch{}return await w(t.name,t.type||"image/jpeg",t)}async function x(){const t=await p();return!t||!j(t)?(f("Please sign in as a promoter.","error"),null):(document.body.classList.add("authenticated"),t)}async function C(){try{const t=await h("/profiles/promoters/me",{method:"GET"});if(l("orgName",t.orgName),l("address",t.address),l("city",t.city),l("region",t.region),l("country",t.country),l("website",t.website),l("contact",t.contact),l("bio",t.bio),t.socials&&typeof t.socials=="object")for(const[a,s]of Object.entries(t.socials))l(`social_${a}`,s);const e=document.getElementById("logoPreview");e&&$(e,t.logoKey);const{sub:o}=await p()||{};y=Array.isArray(t.mediaKeys)?t.mediaKeys.map(a=>K(a,o)):[],u=Array.isArray(t.highlights)?[...t.highlights]:[],E(),b()}catch(t){console.debug("loadMe:",t.message||t)}}async function T(){var B,I,S;if(!await x())return;const e=document.getElementById("logo"),o=document.getElementById("logoPreview");e==null||e.addEventListener("change",()=>{var n;const r=(n=e.files)==null?void 0:n[0];!r||!o||(o.src=URL.createObjectURL(r))}),(B=document.getElementById("addPhotosBtn"))==null||B.addEventListener("click",async()=>{const r=document.getElementById("photoFiles"),n=Array.from((r==null?void 0:r.files)||[]);if(n.length)try{const{sub:m}=await p()||{};for(const i of n){const c=await w(i.name,i.type||"image/jpeg",i,{actor:"promoter",type:"gallery"});y.push(c)}E(),r.value=""}catch(m){console.error(m),f("Photo upload failed","error")}}),(I=document.getElementById("addHighlightUrlBtn"))==null||I.addEventListener("click",()=>{const r=document.getElementById("highlightUrl"),n=((r==null?void 0:r.value)||"").trim();n&&(u.push(n),b(),r.value="")}),(S=document.getElementById("uploadHighlightBtn"))==null||S.addEventListener("click",async()=>{var m;const r=document.getElementById("highlightFile"),n=(m=r==null?void 0:r.files)==null?void 0:m[0];if(n)try{const{sub:i}=await p()||{},c=await w(n.name,n.type||"video/mp4",n,{actor:"promoter",type:"highlight"}),g=typeof c=="string"&&c.startsWith("public/")?v(c):c;u.push(g),b(),r.value=""}catch(i){console.error(i),f("Video upload failed","error")}});const a=document.getElementById("promoForm"),s=document.getElementById("saveBtn");a==null||a.addEventListener("submit",async r=>{r.preventDefault(),P(s,!0);try{const n={orgName:d("orgName"),address:d("address"),city:d("city"),region:d("region"),country:d("country"),website:d("website"),contact:d("contact"),bio:d("bio"),mediaKeys:y,highlights:u},m=["twitter","instagram","facebook","tiktok","youtube","website"],i={};for(const L of m){const k=d(`social_${L}`);k&&(i[L]=k)}Object.keys(i).length&&(n.socials=i);const c=await U();c&&(n.logoKey=c),n.mediaKeys=y,n.highlights=u;const g=await h("/profiles/promoters",{method:"PUT",body:n});f("Promotion saved!"),g!=null&&g.logoKey&&o&&$(o,g.logoKey)}catch(n){console.error(n),f((n==null?void 0:n.message)||"Save failed","error")}finally{P(s,!1)}}),await C()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",T,{once:!0}):T();
