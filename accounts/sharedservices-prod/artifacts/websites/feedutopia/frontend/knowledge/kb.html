<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>FeedUtopia – Knowledge Base</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root {
  --accent: #ec008c;
  --bg-darker: #111;
  --bg-dark: #222;
  --text-main: #eee;
}

body {
  margin: 0;
  background: var(--bg-darker);
  color: var(--text-main);
  font-family: system-ui, sans-serif;
}

/* ── top bar ─────────────────────────────────────────────── */
header {
  background: var(--accent);
  padding: 1rem 1.5rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: #fff;
  flex-wrap: wrap;
}

nav {
  display: flex;
  align-items: center;
  gap: 1.25rem;
  flex-wrap: wrap;
}

nav a {
  color: #fff;
  text-decoration: none;
  font-weight: 600;
}

.dropdown {
  position: relative;
}

.dropdown > a::after {
  content: "▼";
  font-size: .55rem;
  margin-left: .35rem;
  opacity: .7;
}

.dropdown-content {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  background: var(--bg-dark);
  padding: .5rem 0;
  border-radius: 6px;
  min-width: 180px;
  z-index: 10;
}

.dropdown-content a {
  display: block;
  padding: .5rem 1rem;
  font-weight: 500;
}

.dropdown:hover .dropdown-content {
  display: block;
}

/* ── page content ───────────────────────────────────────── */
main {
  padding: 1.5rem;
  max-width: 900px;
  margin: auto;
}

h1 {
  font-size: 1.8rem;
  margin-bottom: 1rem;
}

#add-btn {
  background: var(--accent);
  color: #fff;
  border: none;
  padding: .6rem 1.2rem;
  border-radius: 6px;
  cursor: pointer;
  margin-bottom: 1.5rem;
  font-weight: 600;
}

#kb-list .kb-article {
  background: var(--bg-dark);
  padding: 1rem 1.2rem;
  border-radius: 8px;
  margin-bottom: 1.2rem;
}

#kb-list .kb-article h2 {
  margin: .2rem 0 .4rem;
  color: var(--accent);
}

textarea, input {
  width: 100%;
  padding: .55rem;
  border-radius: 6px;
  border: none;
  background: #333;
  color: #eee;
}

dialog {
  border: none;
  border-radius: 10px;
  padding: 2rem;
  background: #222;
  color: #eee;
  width: 90%;
  max-width: 600px;
}

dialog form {
  display: flex;
  flex-direction: column;
  gap: .8rem;
}

dialog button {
  background: var(--accent);
  color: #fff;
  border: none;
  padding: .55rem 1.2rem;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  align-self: flex-start;
}

/* ── responsive tweaks ─────────────────────────────────── */
@media(max-width: 600px) {
  header {
    padding: 0.75rem 1rem;
  }

  nav {
    gap: 0.8rem;
  }

  h1 {
    font-size: 1.5rem;
  }

  #add-btn {
    width: 100%;
    text-align: center;
  }

  #kb-list .kb-article h2 {
    font-size: 1.1rem;
  }

  textarea, input {
    font-size: .95rem;
  }
}
</style>
</head>
<body>

<header>
  <div style="font-weight:700">FeedUtopia</div>
  <nav>
    <a href="/index.html">Home</a>
    <div class="dropdown">
      <a href="#!">Accounts</a>
      <div class="dropdown-content">
        <a href="/account-pages/animeutopia.html">Anime Utopia</a>
        <a href="/account-pages/wrestleutopia.html">Wrestle Utopia</a>
        <a href="/account-pages/driftutopia.html">Drift Utopia</a>
        <a href="/account-pages/xputopia.html">XP Utopia</a>
        <a href="/account-pages/critterutopia.html">Critter Utopia</a>
        <a href="/account-pages/cyberutopia.html">Cyber Utopia</a>
      </div>
    </div>
    <a href="/orders.html">Orders</a>
    <a href="/kb.html">Knowledge Base</a>
  </nav>
</header>

<main>
  <h1>Knowledge Base</h1>
  <button id="add-btn">➕ Add Article</button>
  <section id="kb-list"></section>
</main>

<dialog id="kb-dialog">
  <form id="kb-form">
    <input id="kb-title" placeholder="Article title" required>
    <textarea id="kb-body" rows="10" placeholder="Markdown or plain‑text…" required></textarea>
    <button type="submit">Publish</button>
  </form>
</dialog>

<script>
const apiRoot = "https://api.feedutopia.com";   // your custom domain

const dialog = document.getElementById('kb-dialog');
const listEl = document.getElementById('kb-list');

document.getElementById('add-btn').onclick = () => dialog.showModal();

document.getElementById('kb-form').onsubmit = async (e) => {
  e.preventDefault();
  const title   = document.getElementById('kb-title').value.trim();
  const content = document.getElementById('kb-body').value.trim();

  // 1. ask backend for a presigned URL
  const presign = await fetch(`${apiRoot}/kb/upload-url`, {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({title})
  }).then(r => r.json());

  // 2. PUT the article body
  await fetch(presign.uploadUrl, {
    method:'PUT',
    headers:{'Content-Type':'application/json', 'x-amz-meta-title': title},
    body: JSON.stringify({title, content, created: presign.created})
  });

  dialog.close();
  loadKB();                 // refresh the list
};

async function loadKB(){
  const items = await fetch(`${apiRoot}/kb`).then(r=>r.json());
  listEl.innerHTML = '';
  items.forEach(a=>{
    const el = document.createElement('article');
    el.className = 'kb-article';
    el.innerHTML = `<h2>${a.title}</h2>
                    <small>${new Date(a.created).toLocaleDateString()}</small>`;
    el.onclick = ()=>window.open(`${apiRoot.replace('api.','')}/kb/${a.key}`,'_blank');
    listEl.appendChild(el);
  });
}
loadKB();
</script>

<script defer src="/utopium-widget.js"></script>
</body>
</html>
